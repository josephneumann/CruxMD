/**
 * Core TypeScript types for CruxMD frontend.
 *
 * Note: API-specific types are auto-generated by @hey-api/openapi-ts
 * in lib/generated/. This file contains application-level types that
 * extend or complement the generated types.
 */

/**
 * Generic API response wrapper for list endpoints.
 */
export interface PaginatedResponse<T> {
  items: T[];
  total: number;
  page: number;
  pageSize: number;
}

/**
 * Patient summary for list views.
 * This is the shape returned by GET /api/patients.
 */
export interface PatientSummary {
  id: string;
  fhir_id: string;
  data: FhirPatient;
}

/**
 * FHIR Patient resource (simplified).
 * Full FHIR R4 Patient type is complex; this covers common fields.
 */
export interface FhirPatient {
  resourceType: "Patient";
  id?: string;
  name?: FhirHumanName[];
  gender?: "male" | "female" | "other" | "unknown";
  birthDate?: string;
  address?: FhirAddress[];
  telecom?: FhirContactPoint[];
  identifier?: FhirIdentifier[];
}

/**
 * FHIR HumanName type.
 */
export interface FhirHumanName {
  use?: "usual" | "official" | "temp" | "nickname" | "anonymous" | "old" | "maiden";
  family?: string;
  given?: string[];
  prefix?: string[];
  suffix?: string[];
  text?: string;
}

/**
 * FHIR Address type.
 */
export interface FhirAddress {
  use?: "home" | "work" | "temp" | "old" | "billing";
  type?: "postal" | "physical" | "both";
  line?: string[];
  city?: string;
  state?: string;
  postalCode?: string;
  country?: string;
}

/**
 * FHIR ContactPoint type.
 */
export interface FhirContactPoint {
  system?: "phone" | "fax" | "email" | "pager" | "url" | "sms" | "other";
  value?: string;
  use?: "home" | "work" | "temp" | "old" | "mobile";
}

/**
 * FHIR Identifier type.
 */
export interface FhirIdentifier {
  use?: "usual" | "official" | "temp" | "secondary" | "old";
  system?: string;
  value?: string;
}

/**
 * FHIR Bundle load response.
 */
export interface BundleLoadResponse {
  message: string;
  resources_loaded: number;
  patient_id: string | null;
}

/**
 * Helper to extract display name from FHIR Patient.
 */
export function getPatientDisplayName(patient: FhirPatient): string {
  const name = patient.name?.[0];
  if (!name) return "Unknown";

  if (name.text) return name.text;

  const given = name.given?.join(" ") || "";
  const family = name.family || "";
  return `${given} ${family}`.trim() || "Unknown";
}
