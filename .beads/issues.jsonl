{"id":"CruxMD-012","title":"Story 9.1: Makefile Setup","description":"Create root Makefile with targets: help, install, dev, test, lint, format, build, generate-fixtures, generate-profiles, seed, migrate, generate-api","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:51.14886-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T10:52:24.609987-06:00","closed_at":"2026-01-24T10:52:24.609987-06:00","close_reason":"Closed","dependencies":[{"issue_id":"CruxMD-012","depends_on_id":"CruxMD-pz7","type":"blocks","created_at":"2026-01-17T13:14:10.536336-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-02p","title":"Story 7.2: Production Configuration","description":"Create docker-compose.prod.yml, Caddyfile for reverse proxy + auto HTTPS, deploy.sh script, repoint DNS","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:44.554617-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T15:12:04.265787-06:00","closed_at":"2026-01-24T15:12:04.265787-06:00","close_reason":"Completed. Created docker-compose.prod.yml, Caddyfile, deploy.sh. See branch CruxMD-02p-work.","dependencies":[{"issue_id":"CruxMD-02p","depends_on_id":"CruxMD-pz7","type":"blocks","created_at":"2026-01-17T13:14:06.722023-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-02p","depends_on_id":"CruxMD-7qj","type":"blocks","created_at":"2026-01-17T13:14:06.837607-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-034","title":"Story 6.2: Local Development Verification","description":"Verify docker compose up, database migrations, Neo4j connectivity, fixtures loading, and frontend patient listing","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:23.647236-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T15:33:30.01342-06:00","closed_at":"2026-01-24T15:33:30.01342-06:00","close_reason":"Verified: Docker compose up works, all services healthy, migrations run, Neo4j connected, 5 patients + 3851 resources seeded, frontend serves chat page, 103 tests pass. Fixed two bugs: committed API client for Docker builds and removed obsolete parameter from seed script.","dependencies":[{"issue_id":"CruxMD-034","depends_on_id":"CruxMD-pz7","type":"blocks","created_at":"2026-01-17T13:14:05.335664-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-034","depends_on_id":"CruxMD-bfs","type":"blocks","created_at":"2026-01-17T13:14:05.45051-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-04y","title":"Add fixtures volume mount to docker-compose.prod.yml","description":"During initial deployment, fixtures had to be manually copied into the backend container with 'docker cp'. Add a volume mount for ./fixtures:/fixtures in docker-compose.prod.yml so the seed script works automatically.","status":"closed","priority":3,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T15:55:21.540393-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T16:00:03.350266-06:00","closed_at":"2026-01-24T16:00:03.350266-06:00","close_reason":"Closed"}
{"id":"CruxMD-0wp","title":"Story 9.2: GitHub Actions CI","description":"Create ci.yml workflow with backend job (pytest, ruff, type check), frontend job (lint, type-check, build), service containers","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:51.381776-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T11:32:17.513017-06:00","closed_at":"2026-01-24T11:32:17.513017-06:00","close_reason":"Completed. See branch CruxMD-0wp-work.","dependencies":[{"issue_id":"CruxMD-0wp","depends_on_id":"CruxMD-012","type":"blocks","created_at":"2026-01-17T13:14:10.650632-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-0wp","depends_on_id":"CruxMD-8qg","type":"blocks","created_at":"2026-01-17T13:14:10.758605-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-181","title":"Story 1.2: Embedding Service","description":"Create embedding generation service using OpenAI text-embedding-3-small.\n\nFiles:\n- Create: backend/app/services/embeddings.py\n\nAcceptance Criteria:\n- OpenAI text-embedding-3-small integration\n- Text templates for each embeddable type:\n  - Condition, Observation, MedicationRequest, AllergyIntolerance\n  - Procedure, Encounter, DiagnosticReport, DocumentReference, CarePlan\n- Batch embedding support (reduce API calls)\n- Mock-able for testing (no real API calls in tests)\n\nPart of Epic 1: Embedding Infrastructure","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:17:26.223876-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T17:27:49.360375-06:00","closed_at":"2026-01-24T17:27:49.360375-06:00","close_reason":"Completed. See branch CruxMD-181-work."}
{"id":"CruxMD-1e2","title":"fix: Encounter nodes missing fhir_resource property","description":"Encounter nodes don't store fhir_resource like every other node type. Add fhir_resource=json.dumps(resource) to _upsert_encounter SET clause. One-line fix + parameter addition.\n\nFiles: backend/app/services/graph.py, backend/tests/test_graph.py\nAcceptance:\n- Encounter node has fhir_resource property after upsert\n- json.loads(encounter_node['fhir_resource']) returns valid FHIR Encounter\n- Test verifies fhir_resource is stored and parseable","status":"closed","priority":1,"issue_type":"bug","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T20:20:14.281247-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T20:24:57.730004-06:00","closed_at":"2026-02-01T20:24:57.730004-06:00","close_reason":"Added fhir_resource to _upsert_encounter SET clause and parameter list. Test verifies json.loads roundtrip."}
{"id":"CruxMD-1i9","title":"Backend: PhysicianProfile model + migration","description":"Create UserProfile SQLAlchemy model matching existing user_profiles table (NOTE: model name is UserProfile, not PhysicianProfile â€” matches table name per codebase convention).\n\nChanges:\n1. Create backend/app/models/user_profile.py with UserProfile model\n2. Match existing migration columns: id (UUID PK), user_id (Text, unique), display_name, specialty, fhir_practitioner_id, created_at, updated_at\n3. Add crux_config JSONB column with server_default=text(\"'{}'\\:\\:jsonb\")\n4. Add onupdate=func.now() on updated_at\n5. Register model in models/__init__.py\n6. Alembic migration: add crux_config column, FK constraint on user_id â†’ user.id, CHECK constraint pg_column_size(crux_config) \u003c 50000\n7. Verify with alembic revision --autogenerate that model matches migration\n\nFollow patterns from: backend/app/models/session.py (UUID, timestamps, JSONB with server_default)","status":"open","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T16:36:25.55455-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T16:46:01.275548-06:00"}
{"id":"CruxMD-1rn","title":"P0 Epic 4: Test Fixtures Generation","status":"closed","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:09:10.457739-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T11:40:12.333013-06:00","closed_at":"2026-01-24T11:40:12.333013-06:00","close_reason":"All dependencies complete: Story 4.1 (Synthea Fixtures), Story 4.2 (Patient Profiles), Story 4.3 (Database Seeding). Test fixtures generation pipeline is operational.","dependencies":[{"issue_id":"CruxMD-1rn","depends_on_id":"CruxMD-z15","type":"blocks","created_at":"2026-01-17T13:27:53.143425-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-1rn","depends_on_id":"CruxMD-4cx","type":"blocks","created_at":"2026-01-17T13:27:53.363878-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-1rn","depends_on_id":"CruxMD-bfs","type":"blocks","created_at":"2026-01-17T13:27:53.578572-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-27m","title":"feat: integrate tool-use into AgentService","description":"Add tool execution loop to generate_response() and generate_response_stream(). Pass tools to OpenAI Responses API, detect function_call, execute tool, feed result back, handle multi-turn. Update system prompt. Files: agent.py, test_agent.py.\n\n## Handoff Context from CruxMD-4wt\n- 5 tools in agent_tools.py: search_patient_data, get_encounter_details, get_lab_history, find_related_resources, get_patient_timeline\n- Each takes explicit deps (graph, db) as params â€” agent service must provide both\n- All tools return plain text strings â€” pass as function_call results to LLM\n- get_patient_timeline accesses graph._driver directly (no public KnowledgeGraph method for encounter listing)\n- get_encounter_details returns events FROM the encounter, not the Encounter resource itself (Encounter fhir_resource was missing when 4wt was built, now fixed)\n- search_patient_data uses graph search only (no vector) â€” vector already runs in ContextEngine\n- search_nodes_by_name now returns 3 keys: fhir_id, resource_type, encounter_fhir_id","status":"closed","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T19:51:30.940388-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T21:09:37.724756-06:00","closed_at":"2026-02-01T21:09:37.724756-06:00","close_reason":"Completed. See branch CruxMD-27m-work.","dependencies":[{"issue_id":"CruxMD-27m","depends_on_id":"CruxMD-4wt","type":"blocks","created_at":"2026-01-31T19:51:37.900262-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-2g1","title":"Story 1.1: Initialize Backend Project","description":"Create backend directory structure, uv project, FastAPI entry point, config, and .env.example","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:10:05.598809-06:00","created_by":"Joe Neumann","updated_at":"2026-01-17T14:38:39.883475-06:00","closed_at":"2026-01-17T14:38:39.883475-06:00","close_reason":"Completed. Backend initialized with FastAPI, config, tests. See branch CruxMD-2g1-work."}
{"id":"CruxMD-2r8","title":"feat: add missing properties to graph nodes (category, reasonCode, abatement)","description":"Add properties to three existing node types in graph.py upsert methods:\n\n1. Observation: add category from category[0].coding[0].code (e.g., \"vital-signs\", \"laboratory\")\n2. Encounter: add reason_display from reasonCode[0].coding[0].display and reason_code from reasonCode[0].coding[0].code\n3. Condition: add abatement_date from abatementDateTime\n\nAll properties NULL-safe when source data absent. Tests for present and absent values.\n\nFiles: backend/app/services/graph.py, backend/tests/test_graph.py","status":"closed","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T20:20:14.384366-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T20:26:55.792921-06:00","closed_at":"2026-02-01T20:26:55.792921-06:00","close_reason":"Completed. See branch CruxMD-2r8-work."}
{"id":"CruxMD-3e8","title":"Backend: Pydantic schemas for crux.md","description":"Create Pydantic schemas for crux_config and API request/response.\n\nSimplified MVP schemas:\n- GeneralPreferences: style (Literal['concise','balanced','detailed']), verbosity (Literal['low','medium','high']), tone (Literal['clinical','conversational','academic']), custom_directives (str | None, max 2000 chars)\n- RoleContext: specialty (str | None), sub_specialties (str | None), practice_setting (str | None), years_experience (int | None), custom_context (str | None, max 2000 chars)\n- PatientCommunication: notes (str | None, max 2000 chars)\n- CruxConfig: version (int), general_preferences, role_context, condition_protocols (dict[str, str] with max 20 entries, each value max 3000 chars), patient_communication\n- UserProfileResponse: id, user_id, display_name, specialty, crux_config, created_at, updated_at\n- UserProfileUpdate: display_name, specialty, crux_config\n\nFollow patterns from: backend/app/schemas/task.py","status":"open","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T16:36:25.661213-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T16:46:01.34162-06:00","dependencies":[{"issue_id":"CruxMD-3e8","depends_on_id":"CruxMD-1i9","type":"blocks","created_at":"2026-02-01T16:36:31.236461-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-3f0","title":"feat: SSE streaming chat - epic","description":"Add SSE streaming to the chat pipeline. Real-time reasoning summaries from OpenAI reasoning models, token-by-token narrative output, structured data (insights, follow-ups) after stream completes. See docs/plans/2026-01-31-feat-streaming-chat-plan.md","status":"open","priority":1,"issue_type":"epic","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T18:53:54.82123-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T18:53:54.82123-06:00"}
{"id":"CruxMD-3gd","title":"Backend: System prompt integration","description":"Wire crux.md into the LLM system prompt pipeline.\n\nChanges:\n1. Add _format_physician_context(crux_config: dict) to agent.py â€” renders JSONB as delimited natural language wrapped in \u003cphysician_preferences boundary=\"crux-XXXX\"\u003e tags\n2. Update SYSTEM_PROMPT_TEMPLATE â€” add physician section AFTER safety constraints and response format (not before)\n3. In chat route _prepare_chat_context(), fetch crux_config via ProfileRepository.get_by_user_id(user_id)\n4. Pass crux_config to build_system_prompt() which calls _format_physician_context()\n5. MVP: load ALL protocols, no selective matching, no token trimming\n\nSecurity:\n- Delimiter protection with boundary marker\n- Input already sanitized at write time (PUT endpoint)\n- Physician section placed AFTER safety constraints\n\nTests: rendering with various configs, empty config, sanitized content, prompt structure verification","status":"open","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T16:36:25.879011-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T16:46:01.471029-06:00","dependencies":[{"issue_id":"CruxMD-3gd","depends_on_id":"CruxMD-1i9","type":"blocks","created_at":"2026-02-01T16:36:31.538543-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-3gd","depends_on_id":"CruxMD-3e8","type":"blocks","created_at":"2026-02-01T16:36:31.635804-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-3qv","title":"feat: add CarePlan graph node type with ADDRESSES edge","description":"Add CarePlan as a graph node type:\n\n1. _upsert_careplan() â€” title/category display, status, period, fhir_resource, addresses_fhir_ids (list of Condition refs)\n2. Add unique constraint on CarePlan.fhir_id in ensure_indexes()\n3. Add dispatch case in build_from_fhir()\n4. Add CarePlan -[:ADDRESSES]-\u003e Condition relationship in _build_clinical_reasoning_relationships() using UNWIND pattern\n5. Do NOT add to search_nodes_by_name or VerifiedLayer\n\nFiles: graph.py, test_graph.py, conftest.py","status":"closed","priority":2,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T20:20:14.591683-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T20:36:44.114592-06:00","closed_at":"2026-02-01T20:36:44.114592-06:00","close_reason":"Implemented CarePlan node type with all 5 acceptance criteria met"}
{"id":"CruxMD-44u","title":"Avatar infra: config, dependency, Caddy static dir, Docker volumes","description":"Phase 1 infrastructure. Add GEMINI_API_KEY to config.py. Add google-genai via uv add. Create ./assets dir. Add Docker volume mounts for backend+caddy. Add Caddy handle block for /assets/* with file_server and cache headers. Migrate existing avatars from frontend/public/brand/avatars/ to assets/avatars/ with FHIR ID filenames.","status":"open","priority":2,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T14:13:08.660406-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T14:13:08.660406-06:00","dependencies":[{"issue_id":"CruxMD-44u","depends_on_id":"CruxMD-awv","type":"blocks","created_at":"2026-02-01T14:13:13.350113-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-4cx","title":"Story 4.2: Patient Profile Generation","description":"Create generate_patient_profiles.py script, implement LLM profile generation from FHIR data, generate profiles for all 5 patients","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:04.60155-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T10:53:31.919658-06:00","closed_at":"2026-01-24T10:53:31.919658-06:00","close_reason":"Closed","dependencies":[{"issue_id":"CruxMD-4cx","depends_on_id":"CruxMD-z15","type":"blocks","created_at":"2026-01-17T13:14:01.045986-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-4gh","title":"feat: lower vector threshold + dedup helper","description":"Change DEFAULT_SIMILARITY_THRESHOLD from 0.7 to 0.4. Add dedup logic to prevent vector results duplicating graph-traversed resources. Files: context_engine.py, tests.\n\n## Handoff Context from CruxMD-md2\n- build_context() already deduplicates: graph results win over vector for same fhir_id\n- extract_concepts() is NOT used â€” tokenize() + remove_stop_words() feed directly to search_nodes_by_name\n- Dedup logic may already be partially implemented in build_context(). Review current state before adding more.\n- Vector threshold is still 0.7 (unchanged by md2, explicitly deferred to this task)","status":"closed","priority":2,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T19:51:30.728891-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T21:05:15.982545-06:00","closed_at":"2026-02-01T21:05:15.982545-06:00","close_reason":"Completed. Threshold lowered 0.7â†’0.4. Dedup already sufficient in build_context(). Branch CruxMD-4gh-work.","dependencies":[{"issue_id":"CruxMD-4gh","depends_on_id":"CruxMD-md2","type":"blocks","created_at":"2026-01-31T19:51:37.70622-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-4jg","title":"Story 5.1: Initialize Frontend Project","description":"Create Next.js 15 project with TypeScript, configure Tailwind CSS, initialize shadcn/ui, create lib/utils.ts","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:20.859158-06:00","created_by":"Joe Neumann","updated_at":"2026-01-17T14:31:53.991266-06:00","closed_at":"2026-01-17T14:31:53.991266-06:00","close_reason":"Completed. Frontend initialized with Next.js 16, TypeScript, Tailwind CSS 4, shadcn/ui. See branch CruxMD-4jg-work."}
{"id":"CruxMD-4wt","title":"feat: agent tool schemas and implementations","description":"Create backend/app/services/agent_tools.py with 5 tools: search_patient_data, get_encounter_details, get_lab_history, find_related_resources, get_patient_timeline. Each wraps graph/Postgres queries, returns formatted text for LLM. Files: agent_tools.py, test_agent_tools.py.\n\n## Handoff Context\n- All traversal methods (get_encounter_events, get_medications_treating_condition, get_procedures_for_condition, get_diagnostic_report_results) now return parsed FHIR JSON, not raw Neo4j dicts.\n- search_nodes_by_name(patient_id, query_terms, resource_types) returns fhir_id + resource_type pairs.\n- Encounter nodes don't store fhir_resource â€” searched by type_display.","status":"closed","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T19:51:30.835028-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T20:02:05.560971-06:00","closed_at":"2026-02-01T20:02:05.560971-06:00","close_reason":"Completed. See branch CruxMD-4wt-work.","dependencies":[{"issue_id":"CruxMD-4wt","depends_on_id":"CruxMD-jfz","type":"blocks","created_at":"2026-01-31T19:51:37.801631-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-4yx","title":"P0 Epic 6: Docker \u0026 Local Development","status":"closed","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:09:10.799005-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T15:34:02.798882-06:00","closed_at":"2026-01-24T15:34:02.798882-06:00","close_reason":"All stories completed: Docker Configuration (6.1) and Local Development Verification (6.2) done.","dependencies":[{"issue_id":"CruxMD-4yx","depends_on_id":"CruxMD-pz7","type":"blocks","created_at":"2026-01-17T13:28:01.417062-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-4yx","depends_on_id":"CruxMD-034","type":"blocks","created_at":"2026-01-17T13:28:01.64105-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-5di","title":"Story 5.3d: Demo fixtures (FHIR tasks + appointments + sessions)","description":"Create FHIR Task fixture JSON for clinical scenarios (critical hyperkalemia, discharge, abnormal imaging, etc). Create FHIR Appointment fixture JSON (8-12 today, 4-6 tomorrow). Create Session fixtures. Update seed_database.py to load through FhirRepository. Patient refs must match Synthea fixtures. Depends on 5.3b, 5.3c.","status":"open","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T19:25:44.573622-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T19:25:44.573622-06:00","dependencies":[{"issue_id":"CruxMD-5di","depends_on_id":"CruxMD-z3b","type":"blocks","created_at":"2026-01-31T19:25:53.267645-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-5di","depends_on_id":"CruxMD-bsk","type":"blocks","created_at":"2026-01-31T19:25:53.363654-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-5er","title":"Story 3.1: FHIR Loader Service","description":"Create fhir_loader.py with load_bundle function for PostgreSQL storage, integrate graph population, create FHIR schemas","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:02.264222-06:00","created_by":"Joe Neumann","updated_at":"2026-01-17T15:38:54.503673-06:00","closed_at":"2026-01-17T15:38:54.503673-06:00","close_reason":"Completed. See branch CruxMD-5er-work. Implemented fhir_loader.py with load_bundle function.","dependencies":[{"issue_id":"CruxMD-5er","depends_on_id":"CruxMD-6iw","type":"blocks","created_at":"2026-01-17T13:13:59.985554-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-5er","depends_on_id":"CruxMD-wpn","type":"blocks","created_at":"2026-01-17T13:14:00.097248-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-5fw","title":"Story 4.2: useChat Hook","description":"Create React hook for chat state management.\n\nFiles:\n- Create: frontend/hooks/useChat.ts or frontend/lib/hooks/useChat.ts\n\nAcceptance Criteria:\n- useChat(patientId) returns messages, sendMessage, isLoading, error\n- Handles patient change (clears history, resets conversation_id)\n- Manages conversation_id lifecycle\n- Proper error handling and retry logic\n\nBlocked by: Story 4.1\nPart of Epic 4: Frontend Conversational Canvas","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:17:58.233558-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T20:51:13.816741-06:00","closed_at":"2026-01-24T20:51:13.816741-06:00","close_reason":"Completed. Pushed to main branch.","dependencies":[{"issue_id":"CruxMD-5fw","depends_on_id":"CruxMD-u78","type":"blocks","created_at":"2026-01-24T17:18:21.327984-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-6iw","title":"Story 1.2: Database Setup","description":"Create async SQLAlchemy engine, FhirResource model, initialize Alembic with async support, create initial migration","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:10:05.820181-06:00","created_by":"Joe Neumann","updated_at":"2026-01-17T15:28:03.929821-06:00","closed_at":"2026-01-17T15:28:03.929821-06:00","close_reason":"Completed. See branch CruxMD-6iw-work.","dependencies":[{"issue_id":"CruxMD-6iw","depends_on_id":"CruxMD-2g1","type":"blocks","created_at":"2026-01-17T13:13:37.39835-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-6oc","title":"Frontend: migrate avatar URLs to FHIR ID + /assets/ path","description":"Phase 5. Update PatientSummaryCard.tsx to use patient.fhir_id for avatar URL: /assets/avatars/{fhir_id}.png. Update Sidebar admin avatar path. Remove old avatar files from frontend/public/brand/avatars/ (keep admin-avatar.png or migrate it too). Verify initials fallback still works.","status":"open","priority":2,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T14:13:09.08361-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T14:13:09.08361-06:00","dependencies":[{"issue_id":"CruxMD-6oc","depends_on_id":"CruxMD-awv","type":"blocks","created_at":"2026-02-01T14:13:13.767967-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-6oc","depends_on_id":"CruxMD-44u","type":"blocks","created_at":"2026-02-01T14:13:14.198863-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-7ab","title":"Story 2.2: Graph Query Methods","description":"Implement get_verified_facts, get_verified_conditions, get_verified_medications, get_verified_allergies methods","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:11:57.48209-06:00","created_by":"Joe Neumann","updated_at":"2026-01-17T15:42:54.860189-06:00","closed_at":"2026-01-17T15:42:54.860189-06:00","close_reason":"Completed. See branch CruxMD-7ab-work.","dependencies":[{"issue_id":"CruxMD-7ab","depends_on_id":"CruxMD-wpn","type":"blocks","created_at":"2026-01-17T13:13:57.936143-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-7e3","title":"Story 3.2: Patient Profile Support","description":"Add profile JSON column to FhirResource, create PatientProfile schema, implement load_bundle_with_profile function","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:02.47931-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T10:09:35.265958-06:00","closed_at":"2026-01-24T10:09:35.265958-06:00","close_reason":"Completed. See branch CruxMD-7e3-work.","dependencies":[{"issue_id":"CruxMD-7e3","depends_on_id":"CruxMD-5er","type":"blocks","created_at":"2026-01-17T13:14:00.207418-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-7pm","title":"P0 Epic 9: Build Automation \u0026 CI/CD","status":"closed","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:09:11.299636-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T11:40:12.534818-06:00","closed_at":"2026-01-24T11:40:12.534818-06:00","close_reason":"All dependencies complete: Story 9.1 (Makefile Setup), Story 9.2 (GitHub Actions CI). CI pipeline is active. Note: Frontend build/type-check deferred due to generated API client dependency (see CruxMD-0wp summary).","dependencies":[{"issue_id":"CruxMD-7pm","depends_on_id":"CruxMD-012","type":"blocks","created_at":"2026-01-17T13:28:09.347351-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-7pm","depends_on_id":"CruxMD-0wp","type":"blocks","created_at":"2026-01-17T13:28:09.574741-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-7qj","title":"Story 7.1: VPS Provisioning","description":"Provision Hetzner CX32 VPS with Ubuntu 24.04, configure SSH, install Docker, configure firewall (80, 443 only)","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:44.316016-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T15:03:33.160102-06:00","closed_at":"2026-01-24T15:03:33.160102-06:00","close_reason":"VPS provisioned: CPX32 Ubuntu 24.04 @ 5.161.247.76, Docker installed, firewall configured (22/80/443), SSH alias configured"}
{"id":"CruxMD-7wk","title":"P0 Epic 2: Knowledge Graph Infrastructure","status":"closed","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:09:10.112036-06:00","created_by":"Joe Neumann","updated_at":"2026-01-17T15:45:24.080621-06:00","closed_at":"2026-01-17T15:45:24.080621-06:00","close_reason":"All underlying stories completed","dependencies":[{"issue_id":"CruxMD-7wk","depends_on_id":"CruxMD-wpn","type":"blocks","created_at":"2026-01-17T13:27:45.101667-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-7wk","depends_on_id":"CruxMD-7ab","type":"blocks","created_at":"2026-01-17T13:27:45.317423-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-7y6","title":"Audit FHIR inter-resource references for graph enrichment","description":"Research task: Systematically audit all FHIR resource types in Synthea bundles to identify reference fields that link resources together.\n\n## Goal\nCreate a comprehensive map of inter-resource relationships available in the FHIR data that could be modeled as edges in Neo4j.\n\n## Resources to Audit\n- MedicationRequest (encounter, reasonReference - already identified)\n- Condition (encounter - already identified)\n- Observation (encounter - already identified)\n- Procedure (encounter - already identified)\n- DiagnosticReport\n- Immunization\n- CarePlan\n- CareTeam\n- Claim / ExplanationOfBenefit\n- DocumentReference\n\n## Deliverable\nA markdown document or structured output listing:\n1. Resource type\n2. Reference field name\n3. Target resource type\n4. Semantic meaning (e.g., 'treats', 'diagnosed during', 'performed during')\n5. Count of resources with this reference populated\n\n## Notes\n- Focus on clinically meaningful relationships\n- Prioritize relationships that enable queries like:\n  - 'What happened during this encounter?'\n  - 'What medications treat this condition?'\n  - 'What observations support this diagnosis?'","status":"closed","priority":2,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T16:29:12.373195-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T11:25:20.120162-06:00","closed_at":"2026-01-24T11:25:20.120162-06:00","close_reason":"Research complete. Comprehensive FHIR reference audit in docs/fhir-reference-audit.md identifies encounter-centric relationships and proposes tiered graph schema for CruxMD-cvc implementation."}
{"id":"CruxMD-8h5","title":"Story 4.3: InsightCard Component","description":"Create reusable InsightCard component for rendering agent insights.\n\nFiles:\n- Create: frontend/components/clinical/InsightCard.tsx\n- Create: frontend/components/clinical/index.ts\n\nAcceptance Criteria:\n- Renders title, content, severity icon\n- Color-coded by type: blue (info), yellow (warning), red (critical), green (positive)\n- Uses shadcn/ui Alert as base component\n- Responsive design\n\nBlocked by: Story 4.1 (needs Insight type)\nPart of Epic 4: Frontend Conversational Canvas","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:17:58.431649-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T20:49:06.050444-06:00","closed_at":"2026-01-24T20:49:06.050444-06:00","close_reason":"Completed. See branch CruxMD-8h5-work.","dependencies":[{"issue_id":"CruxMD-8h5","depends_on_id":"CruxMD-u78","type":"blocks","created_at":"2026-01-24T17:18:21.427301-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-8qg","title":"Story 8.2: Basic Tests","description":"Create test_fhir_loader.py, test_graph.py, test_api.py for bundle loading, Neo4j ops, and endpoint tests","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:49.549768-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T11:01:45.617114-06:00","closed_at":"2026-01-24T11:01:45.617114-06:00","close_reason":"Complete. Fixed duplicates from code review. Tests: 96 (47 unit, 49 integration). Branch: CruxMD-8qg-work","dependencies":[{"issue_id":"CruxMD-8qg","depends_on_id":"CruxMD-qzw","type":"blocks","created_at":"2026-01-17T13:14:08.924061-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-8qg","depends_on_id":"CruxMD-5er","type":"blocks","created_at":"2026-01-17T13:14:09.034885-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-8qg","depends_on_id":"CruxMD-wpn","type":"blocks","created_at":"2026-01-17T13:14:09.146709-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-9g9","title":"fix: CarePlan display NULL and missing Encounter edge","description":"CarePlan nodes have NULL display and no Encounter relationship. Two fixes:\n\n1. **Display**: _upsert_careplan uses _extract_first_coding(category[0]) which gets the generic \"assess-plan\" entry with no display. Synthea CarePlans have category[1] with the meaningful SNOMED display (e.g. \"Lifestyle education regarding hypertension\"). Fix: iterate categories to find first with a display value, or use category[1] directly.\n\n2. **Encounter edge**: All Synthea CarePlans have an encounter reference but _upsert_careplan doesn't extract encounter_fhir_id. Fix: extract encounter_fhir_id using _extract_encounter_fhir_id(resource), store on node, and add CarePlan to _ENCOUNTER_RELATIONSHIPS as (\"CarePlan\", \"HAS_CARE_PLAN\", \"CREATED_DURING\", \"cp\").\n\nFiles: backend/app/services/graph.py, backend/tests/test_graph.py\nAfter fix, re-seed is needed (run seed_database).\n\nAcceptance:\n- CarePlan.display populated with meaningful text (e.g. \"Lifestyle education regarding hypertension (procedure)\")\n- CarePlan.encounter_fhir_id populated from encounter reference\n- Encounter -[:CREATED_DURING]-\u003e CarePlan relationship exists\n- ensure_indexes() has encounter_fhir_id index for CarePlan\n- Tests verify display extraction and encounter relationship","status":"closed","priority":1,"issue_type":"bug","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T20:45:16.182293-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T20:55:28.668068-06:00","closed_at":"2026-02-01T20:55:28.668068-06:00","close_reason":"Completed. Fixed CarePlan display extraction and added Encounter edge."}
{"id":"CruxMD-aeg","title":"Story 4.10: Tasks Page","description":"## Story 4.10: Tasks Page (/tasks)\n\n**Purpose:** Dedicated page for viewing and triaging the prioritized task queue. Replaces the task queue that was originally planned for the right sidebar.\n\n### Design Rationale\n\nPer updated dual sidebar architecture:\n- Left nav = navigation (includes \"Tasks\" link)\n- Right panel = context-specific data only (no task queue)\n- Tasks get their own page for focused triage workflow\n\n### Route\n\n`/tasks` - Full-page task queue view\n\n### Components\n\n**Page:**\n- `frontend/app/tasks/page.tsx` - Tasks page\n\n**Components:**\n- `frontend/components/tasks/TasksPage.tsx` - Main container\n- `frontend/components/tasks/TaskCategorySection.tsx` - Collapsible category (Critical, Routine, Schedule, Research)\n- `frontend/components/tasks/TaskCard.tsx` - Individual task card\n- `frontend/components/tasks/TaskFilters.tsx` - Filter controls\n\n### Layout\n\n```\nâ”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   â”‚                                                                          â”‚\nâ”‚ N â”‚   TASKS                                                    [Filter â–¼]   â”‚\nâ”‚ A â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚\nâ”‚ V â”‚                                                                          â”‚\nâ”‚   â”‚   ğŸš¨ CRITICAL (3)                                                        â”‚\nâ”‚ R â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ A â”‚   â”‚ K+ 6.2 mEq/L                              Robert Chen â”‚ 10m ago â”‚  â”‚\nâ”‚ I â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚ L â”‚   ...                                                                    â”‚\nâ”‚   â”‚                                                                          â”‚\nâ”‚   â”‚   ğŸ“¬ ROUTINE (12)                                              [expand] â”‚\nâ”‚   â”‚   ğŸ“… SCHEDULE (8)                                              [expand] â”‚\nâ”‚   â”‚   ğŸ“š LEARNING (1)                                              [expand] â”‚\nâ”‚   â”‚                                                                          â”‚\nâ”‚   â”‚   [Tab] navigate â€¢ [Enter] engage â€¢ [Esc] hub                           â”‚\nâ””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Interactions\n\n| Action | Trigger | Result |\n|--------|---------|--------|\n| Navigate here | Click \"Tasks\" in left nav or quick pill | Shows /tasks page |\n| Engage task | Click task card or Enter on focused | Navigates to /chat?task=xxx |\n| Filter | Click filter dropdown | Shows filtered tasks |\n| Return to hub | Press Esc or click logo | Returns to /chat |\n| Expand category | Click category header | Shows/hides tasks in category |\n\n### Keyboard Navigation\n\n- `Tab` / `Shift+Tab` - Move between tasks\n- `â†‘` / `â†“` - Move within category\n- `â†` / `â†’` - Move between categories\n- `Enter` - Engage selected task\n- `Space` - Expand/collapse category\n- `Esc` - Return to hub\n\n### Task Card Content\n\n- Task type icon + color\n- Primary text (task title/key finding)\n- Patient name\n- Time since task created\n- Brief description (1-2 lines)\n\n### Acceptance Criteria\n\n- [ ] Tasks page renders at /tasks route\n- [ ] Left nav has \"Tasks\" link that navigates here\n- [ ] Task categories show correct counts\n- [ ] Categories are collapsible\n- [ ] Task cards show type, patient, time, summary\n- [ ] Clicking task navigates to /chat?task=xxx\n- [ ] Keyboard navigation works (Tab, Enter, Esc, arrows)\n- [ ] Filter by category works\n\n### Dependencies\n\n- Story 5.1 (Task Model \u0026 API) - for task data\n- Story 5.3 (Demo Fixtures) - for demo tasks\n- Left nav sidebar (âœ… DONE) - for \"Tasks\" nav link\n\n### Updates Needed\n\n- Add \"Tasks\" nav item to `Sidebar.tsx` pointing to /tasks\n- Update \"Tasks\" quick action pill on chat page to link to /tasks","status":"open","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-26T14:25:47.537093-06:00","created_by":"Joe Neumann","updated_at":"2026-01-26T14:25:47.537093-06:00","dependencies":[{"issue_id":"CruxMD-aeg","depends_on_id":"CruxMD-mde.1","type":"blocks","created_at":"2026-01-26T14:25:52.161745-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-aeg","depends_on_id":"CruxMD-mde.3","type":"blocks","created_at":"2026-01-26T14:25:52.25267-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-aeg","depends_on_id":"CruxMD-5di","type":"blocks","created_at":"2026-01-31T19:26:00.046419-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-awv","title":"Avatar Generation Pipeline","description":"Implement Gemini-powered avatar generation for patient portraits. See docs/plans/2026-02-01-feat-avatar-generation-pipeline-plan.md","status":"open","priority":2,"issue_type":"epic","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T14:12:56.429169-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T14:12:56.429169-06:00"}
{"id":"CruxMD-b7e","title":"Add Session route tests","status":"closed","priority":3,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T17:25:42.630069-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T19:03:32.159031-06:00","closed_at":"2026-01-31T19:03:32.159031-06:00","close_reason":"21 session route tests added and passing"}
{"id":"CruxMD-bfs","title":"Story 4.3: Database Seeding Script","description":"Create seed_database.py script to load all fixtures with profiles into PostgreSQL and Neo4j\n\n## Updated Context (from CruxMD-7e3)\nProfile storage architecture changed from original plan:\n- NO separate `profile` column on FhirResource\n- Profiles stored as FHIR extensions within Patient resource `data` field\n- Use load_bundle_with_profile() to embed profiles during loading\n- Extension URL: \"http://cruxmd.ai/fhir/StructureDefinition/patient-narrative-profile\"\n- No database migration needed - profiles live in existing `data` column","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:04.811956-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T11:27:55.606032-06:00","closed_at":"2026-01-24T11:27:55.606032-06:00","close_reason":"Completed. See branch CruxMD-bfs-work.","dependencies":[{"issue_id":"CruxMD-bfs","depends_on_id":"CruxMD-7e3","type":"blocks","created_at":"2026-01-17T13:14:01.15724-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-bfs","depends_on_id":"CruxMD-4cx","type":"blocks","created_at":"2026-01-17T13:14:01.266782-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-bsk","title":"Story 5.3c: FHIR Appointment repository, schemas, routes","description":"Create Pydantic schemas (AppointmentCreate/Update/Response), AppointmentRepository (CRUD via FhirRepository+projection), routes (GET list, GET by id, GET /fhir, POST, PATCH, DELETE). Wire into FastAPI. Follow Task pattern. Depends on 5.3b.","status":"open","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T19:25:44.485916-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T19:25:44.485916-06:00","dependencies":[{"issue_id":"CruxMD-bsk","depends_on_id":"CruxMD-z3b","type":"blocks","created_at":"2026-01-31T19:25:53.171076-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-buq","title":"feat: Agent data access redesign","description":"Two-phase redesign: Phase 1 graph-centric context assembly, Phase 2 agent tool-use. See docs/plans/2026-01-31-feat-agent-data-access-redesign-plan.md","status":"closed","priority":1,"issue_type":"epic","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T19:51:17.730061-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T21:19:03.204658-06:00","closed_at":"2026-02-01T21:19:03.204658-06:00","close_reason":"All tasks complete: graph search (jfz), query parser (t2y), context schemas (klo), context engine redesign (md2), agent tools (4wt), tool-use integration (27m), vector threshold (4gh). SSE streaming (ij0) is a P2 follow-up, not part of core epic."}
{"id":"CruxMD-cp8","title":"Physician Personalization (crux.md) â€” MVP","description":"Per-physician personalization layer: JSONB config document loaded into LLM system prompt. Profile page for editing. See docs/plans/2026-02-01-feat-crux-md-physician-personalization-plan.md","status":"open","priority":1,"issue_type":"epic","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T16:36:02.236527-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T16:36:02.236527-06:00"}
{"id":"CruxMD-cvc","title":"Add inter-resource relationships to Neo4j knowledge graph","description":"Enhance the Neo4j knowledge graph with edges between FHIR resources (not just Patientâ†’Resource edges).\n\n## Background\nCurrent graph only has Patient-centric edges:\n- Patient â†’ HAS_CONDITION â†’ Condition\n- Patient â†’ HAS_MEDICATION_REQUEST â†’ MedicationRequest\n- Patient â†’ HAS_OBSERVATION â†’ Observation\n- Patient â†’ HAS_ENCOUNTER â†’ Encounter\n- Patient â†’ HAS_ALLERGY_INTOLERANCE â†’ AllergyIntolerance\n\n## Updated Context (from CruxMD-7y6 FHIR Audit)\nThe FHIR reference audit is complete. See docs/fhir-reference-audit.md for detailed findings.\n\n**Key Findings:**\n- Encounter is the temporal hub - all clinical resources have 100% coverage linking to Encounters\n- reasonReference fields provide clinical reasoning links (82% coverage for MedicationRequest, 36% for Procedure)\n- DiagnosticReport-\u003eObservation links have 87% coverage - high value for lab aggregation\n\n**Proposed Relationship Tiers (from audit):**\n- Tier 1 (Essential): Patient-\u003eEncounter-\u003eClinical events (DIAGNOSED, PRESCRIBED, RECORDED, PERFORMED)\n- Tier 2 (Clinical Reasoning): reasonReference links (TREATS), DiagnosticReport-\u003eObservation (CONTAINS_RESULT)\n- Tier 3 (Extended): CarePlan, CareTeam, Immunization links\n- Tier 4 (Administrative): Claim/EOB billing links\n\n**Implementation Approach:**\n- Two-pass loading: create all resources first, then build inter-resource relationships using FHIR IDs\n- graph.py will need encounter_fhir_id stored on nodes to enable second-pass relationship building\n- Handle missing reasonReference refs gracefully (variable coverage)\n\n## Implementation Steps\n1. Update graph.py upsert methods to store encounter_fhir_id on clinical nodes\n2. Add second-pass relationship building after all resources loaded\n3. Extract and create inter-resource edges (DIAGNOSED_DURING, TREATS, etc.)\n4. Handle urn:uuid references (resolve to fhir_id)\n5. Add query methods for traversing these relationships\n6. Update tests\n\n## Value\nEnables clinical queries like:\n- 'What conditions were diagnosed during encounter X?'\n- 'What medication is treating the patient's hypertension?'\n- 'Show me everything that happened in the ER visit'\n- 'Timeline of events for this encounter'","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T16:29:25.935469-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T16:10:05.26096-06:00","closed_at":"2026-01-24T16:10:05.26096-06:00","close_reason":"Completed. See branch CruxMD-cvc-work.","dependencies":[{"issue_id":"CruxMD-cvc","depends_on_id":"CruxMD-7y6","type":"blocks","created_at":"2026-01-17T16:29:31.78205-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-cwf","title":"Story 4.4: ConversationalCanvas","description":"Build the main chat interface integrating all components.\n\nFiles:\n- Create: frontend/components/canvas/ConversationalCanvas.tsx\n- Create: frontend/components/canvas/MessageHistory.tsx\n- Create: frontend/components/canvas/AgentMessage.tsx\n- Create: frontend/components/canvas/UserMessage.tsx\n- Create: frontend/components/canvas/ChatInput.tsx\n- Create: frontend/components/canvas/FollowUpSuggestions.tsx\n- Create: frontend/components/canvas/ThinkingIndicator.tsx\n- Modify: frontend/app/chat/page.tsx (wire up components)\n\nAcceptance Criteria:\n- AgentMessage renders: narrative (markdown), insights, follow-ups\n- ChatInput with send button, Enter to submit, Shift+Enter for newline\n- FollowUpSuggestions as clickable chips (inject text into input)\n- ThinkingIndicator during API calls\n- Scroll management (auto-scroll to bottom on new messages)\n- Data endpoints called when DataQuery visualization present (P1: render placeholder, charts in P2)\n\n## Updated Context (from CruxMD-miu)\nData endpoints now available for DataQuery resolution:\n- GET /api/patients/{id}/labs?codes=...\u0026from=DATE\u0026to=DATE\u0026skip=N\u0026limit=M\n- GET /api/patients/{id}/medications?status=active|all\u0026skip=N\u0026limit=M\n- GET /api/patients/{id}/conditions?status=active|all\u0026skip=N\u0026limit=M\n- GET /api/patients/{id}/timeline?from=DATE\u0026to=DATE\u0026types=...\u0026skip=N\u0026limit=M\n\nNote: Pagination uses `skip` (not `offset`). Response wraps FHIR JSON in `data` field.\nPatient ID is PostgreSQL UUID, not FHIR ID.\n\n## Updated Context (from CruxMD-5fw)\nThe useChat hook is implemented at frontend/hooks/useChat.ts:\n- Import: import { useChat, DisplayMessage } from \"@/hooks\"\n- Usage: const { messages, sendMessage, isLoading, error, clearError, retry, clearMessages } = useChat(patientId)\n- DisplayMessage type extends ChatMessage with id, timestamp, and optional agentResponse for rich rendering\n- A Next.js API route exists at frontend/app/api/chat/route.ts to proxy requests with X-API-Key auth\n- Error handling distinguishes retryable (5xx, 429) from non-retryable errors\n\n## Updated Context (from CruxMD-8h5)\nThe InsightCard component is implemented at frontend/components/clinical/InsightCard.tsx:\n- Import: import { InsightCard } from \"@/components/clinical\"\n- Uses semantic CSS variables (--insight-info, --insight-warning, --insight-critical, --insight-positive)\n- Validates insight types at runtime with fallback to \"info\"\n- Uses lucide-react icons for severity indicators\n\nBlocked by: Story 4.2, Story 4.3\nPart of Epic 4: Frontend Conversational Canvas","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:17:58.634153-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T17:19:37.707985-06:00","closed_at":"2026-01-31T17:19:37.707985-06:00","close_reason":"Completed. See branch CruxMD-cwf-work.","dependencies":[{"issue_id":"CruxMD-cwf","depends_on_id":"CruxMD-5fw","type":"blocks","created_at":"2026-01-24T17:18:22.107678-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-cwf","depends_on_id":"CruxMD-8h5","type":"blocks","created_at":"2026-01-24T17:18:22.210264-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-cwf","depends_on_id":"CruxMD-miu","type":"blocks","created_at":"2026-01-24T17:18:22.306207-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-d9m","title":"Story 7.3: Initial Deployment","description":"Clone repo to VPS, configure production .env, run deployment, load fixtures, verify app at app.cruxmd.ai\n\n## Updated Context (from CruxMD-02p)\n\n**Prerequisites completed:**\n- DNS configured: app.cruxmd.ai â†’ 5.161.247.76\n- VPS provisioned with Docker at 5.161.247.76 (ssh cruxmd)\n- Production config files created: docker-compose.prod.yml, Caddyfile, deploy.sh\n\n**Deployment steps:**\n1. SSH to VPS: `ssh cruxmd`\n2. Clone repo: `git clone git@github.com:josephneumann/CruxMD.git`\n3. Create .env from .env.example with: DB_PASSWORD, NEO4J_PASSWORD, OPENAI_API_KEY, API_KEY, DOMAIN=app.cruxmd.ai, CORS_ORIGINS=https://app.cruxmd.ai\n4. Run: `chmod +x deploy.sh \u0026\u0026 ./deploy.sh`\n5. Caddy auto-obtains Let's Encrypt cert on first HTTPS request\n6. Load fixtures: `docker compose -f docker-compose.prod.yml exec backend python -m app.scripts.seed_database`\n7. Verify at https://app.cruxmd.ai\n\n**Notes:**\n- API docs (/docs, /openapi.json) disabled in production for security\n- Can re-enable by uncommenting in Caddyfile if needed for debugging","notes":"Acceptance: Repo cloned, .env configured, deploy.sh run, fixtures loaded, app live at https://app.cruxmd.ai","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:44.788364-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T15:55:36.650902-06:00","closed_at":"2026-01-24T15:55:36.650902-06:00","close_reason":"Deployed to https://app.cruxmd.ai - 5 containers running, database seeded with 5 patients/3851 resources, SSL active via Caddy","dependencies":[{"issue_id":"CruxMD-d9m","depends_on_id":"CruxMD-7qj","type":"blocks","created_at":"2026-01-17T13:14:06.948914-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-d9m","depends_on_id":"CruxMD-02p","type":"blocks","created_at":"2026-01-17T13:14:07.058916-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-d9m","depends_on_id":"CruxMD-bfs","type":"blocks","created_at":"2026-01-17T13:14:07.165331-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-dcu","title":"feat: streaming UI components","description":"ThinkingIndicator: accept reasoningText prop, show real reasoning text with blinking cursor, max-h-32 overflow-y-auto. MessageHistory: pass streaming.reasoningText to indicator. AgentMessage: blinking cursor during narrative phase, hide insights/follow-ups while streaming. Files: ThinkingIndicator.tsx, MessageHistory.tsx, AgentMessage.tsx","status":"closed","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T18:54:05.595989-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T20:20:24.909742-06:00","closed_at":"2026-01-31T20:20:24.909742-06:00","close_reason":"PR #47 created","dependencies":[{"issue_id":"CruxMD-dcu","depends_on_id":"CruxMD-scp","type":"blocks","created_at":"2026-01-31T18:54:10.908434-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-dmf","title":"P1 Epic 1: Embedding Infrastructure","status":"closed","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:16:58.472334-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T18:00:49.038643-06:00","closed_at":"2026-01-24T18:00:49.038643-06:00","close_reason":"All stories complete: 1.1 pgvector Migration, 1.2 Embedding Service, 1.3 Bundle Loader Integration. Embedding infrastructure ready.","dependencies":[{"issue_id":"CruxMD-dmf","depends_on_id":"CruxMD-qsq","type":"blocks","created_at":"2026-01-24T17:18:30.808911-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-dmf","depends_on_id":"CruxMD-181","type":"blocks","created_at":"2026-01-24T17:18:30.911716-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-dmf","depends_on_id":"CruxMD-t3q","type":"blocks","created_at":"2026-01-24T17:18:31.00692-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-dv4","title":"Story 3.3: Chat API Endpoint","description":"Create POST /api/chat endpoint exposing agent service.\n\nFiles:\n- Create: backend/app/routes/chat.py\n- Modify: backend/app/main.py (register router)\n\nAPI Contract:\nPOST /api/chat\nRequest: { patient_id: UUID, message: str, conversation_id?: UUID, conversation_history?: list }\nResponse: AgentResponse\n\nAcceptance Criteria:\n- Non-streaming for P1 (streaming is P2)\n- API key authentication required\n- Creates conversation_id if not provided (in-memory only, no persistence)\n- 12-15 tests including auth, validation, integration\n\n## Updated Context (from CruxMD-iku)\nService instantiation pattern:\n- AgentService(client=None) - optional AsyncOpenAI client for testing\n- AgentService.generate_response(context, message, history, reasoning_effort)\n- Default model: \"gpt-5.2\", default reasoning_effort: \"low\"\n\nError handling:\n- AgentService raises RuntimeError when parse fails (no silent fallbacks)\n- Route should catch and return appropriate HTTP error\n\nIntegration:\n1. Build PatientContext via ContextEngine.build_context(patient_id, message)\n2. Call AgentService.generate_response(context, message, history)\n3. Return AgentResponse directly (Pydantic serializes to JSON)\n\nConsider: Rate limiting at route level, not in AgentService.\n\nPart of Epic 3: Agent Service \u0026 Chat API","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:17:57.577085-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T19:30:13.621468-06:00","closed_at":"2026-01-24T19:30:13.621468-06:00","close_reason":"Completed. See branch CruxMD-dv4-work.","dependencies":[{"issue_id":"CruxMD-dv4","depends_on_id":"CruxMD-iku","type":"blocks","created_at":"2026-01-24T17:18:19.667821-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-foa","title":"API endpoint: POST /api/avatars/generate/{patient_id}","description":"Phase 4. Add route in backend/app/routes/avatars.py. Auth via Depends(verify_bearer_token). Look up patient, extract demographics, call AvatarGeneratorService. Return {url, generated_at}. Error responses: 404 patient not found, 422 content filter, 429 rate limited, 503 API down.","status":"open","priority":2,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T14:13:08.971464-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T14:13:08.971464-06:00","dependencies":[{"issue_id":"CruxMD-foa","depends_on_id":"CruxMD-awv","type":"blocks","created_at":"2026-02-01T14:13:13.663559-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-foa","depends_on_id":"CruxMD-ojo","type":"blocks","created_at":"2026-02-01T14:13:14.078298-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-gr8","title":"P0 Epic 3: FHIR Data Pipeline","status":"closed","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:09:10.276374-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T10:44:50.725366-06:00","closed_at":"2026-01-24T10:44:50.725366-06:00","close_reason":"All dependencies complete: Story 3.1 (FHIR Loader) and Story 3.2 (Patient Profile Support) both done","dependencies":[{"issue_id":"CruxMD-gr8","depends_on_id":"CruxMD-5er","type":"blocks","created_at":"2026-01-17T13:27:52.721056-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-gr8","depends_on_id":"CruxMD-7e3","type":"blocks","created_at":"2026-01-17T13:27:52.92933-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-gzu","title":"feat: drop GPT-4.1, always use reasoning params","description":"Remove GPT-4.1 from MODEL_OPTIONS in frontend/lib/types.ts. Remove REASONING_MODELS conditional in backend/app/services/agent.py â€” always pass reasoning param since all remaining models (GPT-5, GPT-5 mini) are reasoning models. Update model selector to only show GPT-5 (default) and GPT-5 mini.","status":"closed","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T19:00:32.072156-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T19:02:48.503653-06:00","closed_at":"2026-01-31T19:02:48.503653-06:00","close_reason":"Removed GPT-4.1 from MODEL_OPTIONS, removed REASONING_MODELS set and conditional, always pass reasoning param","dependencies":[{"issue_id":"CruxMD-gzu","depends_on_id":"CruxMD-3f0","type":"blocks","created_at":"2026-01-31T19:00:35.570886-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-hq4","title":"P0 Epic 1: Backend Infrastructure","status":"closed","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:09:09.936628-06:00","created_by":"Joe Neumann","updated_at":"2026-01-17T15:45:24.075921-06:00","closed_at":"2026-01-17T15:45:24.075921-06:00","close_reason":"All underlying stories completed","dependencies":[{"issue_id":"CruxMD-hq4","depends_on_id":"CruxMD-2g1","type":"blocks","created_at":"2026-01-17T13:27:44.281337-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-hq4","depends_on_id":"CruxMD-6iw","type":"blocks","created_at":"2026-01-17T13:27:44.486188-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-hq4","depends_on_id":"CruxMD-uut","type":"blocks","created_at":"2026-01-17T13:27:44.690172-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-hq4","depends_on_id":"CruxMD-w1v","type":"blocks","created_at":"2026-01-17T13:27:44.897415-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-i8f","title":"Story 5.3a: Task FHIR field audit","description":"Audit existing Task serializer FHIR mappings. Verify intent, authoredOn, lastModified, reference formats (Patient/{fhir_id} not uuid). Review whether legacy tasks SQLAlchemy table is unused and can be dropped. Document gaps. See docs/plans/2026-01-31-refactor-epic5-fhir-appointments-task-audit-plan.md","status":"open","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T19:25:44.309451-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T19:25:44.309451-06:00"}
{"id":"CruxMD-ij0","title":"feat: SSE streaming events for tool-use","description":"Emit tool_call and tool_result SSE events during streaming for frontend visibility. Files: chat.py, tests. Depends on agent tool-use integration + streaming epic complete.\n\n## Handoff Context from CruxMD-27m\n- Streaming path when tools are available currently uses non-streaming .parse() for all tool rounds, then returns early with \"done\" event. This task should rework to emit tool_call/tool_result SSE events during execution.\n- TOOL_SCHEMAS use strict:True for OpenAI structured output validation.\n- _run_tool_rounds() is a shared method used by both generate_response() and generate_response_stream() â€” streaming tool events should be added within or alongside this method.\n- Tool results are plain text strings fed back as function_call_output.\n- MAX_TOOL_ROUNDS=10 prevents infinite loops.","status":"in_progress","priority":2,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T19:51:31.05445-06:00","created_by":"Joe Neumann","updated_at":"2026-02-02T19:33:55.645503-06:00","dependencies":[{"issue_id":"CruxMD-ij0","depends_on_id":"CruxMD-27m","type":"blocks","created_at":"2026-01-31T19:51:37.996647-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-ij0","depends_on_id":"CruxMD-dcu","type":"blocks","created_at":"2026-01-31T19:52:37.094462-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-ij8","title":"Story 2.1: PatientContext Schemas","description":"Define Pydantic schemas for patient context used by context engine.\n\nFiles:\n- Create: backend/app/schemas/context.py\n\nKey Types:\n- PatientContext: meta, patient, profile_summary, verified, retrieved, constraints\n- ContextMeta: token_budget, retrieval_stats\n- VerifiedLayer: HIGH confidence facts from Neo4j (conditions, medications, allergies)\n- RetrievedLayer: MEDIUM confidence from pgvector semantic search\n\nAcceptance Criteria:\n- All types have proper validation\n- 8-10 unit tests covering serialization/validation\n\nPart of Epic 2: Context Engine","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:17:26.65435-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T17:27:42.699681-06:00","closed_at":"2026-01-24T17:27:42.699681-06:00","close_reason":"Completed. See branch CruxMD-ij8-work."}
{"id":"CruxMD-iku","title":"Story 3.2: Agent Service Core","description":"Create LLM agent service with structured output using gpt-5.2.\n\nFiles:\n- Create: backend/app/services/agent.py\n\nAcceptance Criteria:\n- generate_response(context, message, history) method\n- gpt-5.2 via Responses API with text.format structured output\n- System prompt with verified facts as constraints\n- Conversation history support\n- Returns validated AgentResponse\n- Reasoning effort: configurable (default: low for fast responses)\n- 15-20 unit tests\n\n## Updated Context (from CruxMD-r8s and CruxMD-oin)\nSchema imports from app.schemas:\n- AgentResponse, Insight, Visualization, etc.\n- Parse LLM JSON output via AgentResponse.model_validate_json()\n- FollowUp uses `question` and `intent` fields\n\nContextEngine usage (from app.services.context_engine):\n- ContextEngine requires THREE dependencies via constructor:\n  - KnowledgeGraph (for verified facts)\n  - EmbeddingService (for query embedding)\n  - VectorSearchService (for semantic search)\n- build_context(patient_id, query, token_budget) returns PatientContext\n- PatientContext.constraints contains safety constraints from verified facts\n- Use constraints in system prompt for LLM\n\nFHIR helpers available: app.utils.fhir_helpers for parsing resources\n\nNote: Responses API is newer - may need API exploration time.\n\nPart of Epic 3: Agent Service \u0026 Chat API","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:17:57.305033-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T19:07:05.311587-06:00","closed_at":"2026-01-24T19:07:05.311587-06:00","close_reason":"Completed. See branch CruxMD-iku-work.","dependencies":[{"issue_id":"CruxMD-iku","depends_on_id":"CruxMD-r8s","type":"blocks","created_at":"2026-01-24T17:18:18.969016-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-iku","depends_on_id":"CruxMD-oin","type":"blocks","created_at":"2026-01-24T17:18:19.07148-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-jfz","title":"feat: graph node search + fix traversal return types","description":"Add search_nodes_by_name(patient_id, query_terms, resource_types) to KnowledgeGraph â€” fuzzy match node display properties. Fix existing traversal methods (get_encounter_events, get_medications_treating_condition, etc.) to return parsed FHIR via json.loads(node['fhir_resource']). Files: graph.py, test_graph.py. See plan doc.","status":"closed","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T19:51:30.324644-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T19:29:51.641052-06:00","closed_at":"2026-02-01T19:29:51.641052-06:00","close_reason":"Completed. See branch CruxMD-jfz-work."}
{"id":"CruxMD-klo","title":"feat: context schema extensions for graph traversal","description":"Extend RetrievedResource.reason Literal to include 'graph_traversal'. Add graph_traversal_count to RetrievalStats. Files: backend/app/schemas/context.py + tests. See plan doc.","status":"closed","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T19:51:30.524758-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T19:26:40.060334-06:00","closed_at":"2026-02-01T19:26:40.060334-06:00","close_reason":"Completed. See branch CruxMD-klo-work."}
{"id":"CruxMD-lwc","title":"feat: add streaming agent method","description":"Add generate_response_stream() async generator to AgentService. Uses client.responses.stream() with text_format=AgentResponse. Yields (event_type, data_json) tuples mapping response.reasoning_summary_text.delta â†’ reasoning, response.output_text.delta â†’ narrative. Final parsed response from stream.get_final_response(). File: backend/app/services/agent.py","status":"closed","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T18:53:58.788477-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T19:15:05.646259-06:00","closed_at":"2026-01-31T19:15:05.646259-06:00","close_reason":"Completed. See branch CruxMD-lwc-work.","dependencies":[{"issue_id":"CruxMD-lwc","depends_on_id":"CruxMD-gzu","type":"blocks","created_at":"2026-01-31T19:00:35.450284-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-md2","title":"feat: redesign ContextEngine for graph-centric retrieval","description":"Core Phase 1 task. Modify build_context() to: (1) call query parser for concepts, (2) call graph.search_nodes_by_name(), (3) traverse 1-2 hops, (4) merge into RetrievedLayer with reason=graph_traversal, (5) vector search at 0.4 threshold for discovery, (6) deduplicate. Files: context_engine.py, test_context_engine.py.\n\n## Handoff Context from Dependencies\n- graph.search_nodes_by_name(patient_id, query_terms, resource_types) returns fhir_id + resource_type pairs. Uses individual Cypher queries per resource type (7 max). Encounter nodes searched by type_display, not display.\n- query_parser.extract_concepts() takes list of (display_name, resource_type) tuples, returns ConceptMatch(term, resource_type_hint). Pure logic, no I/O. Matching is unidirectional (query token as substring of display name).\n- RetrievedResource.reason now accepts 'graph_traversal'. RetrievalStats has graph_traversal_count (defaults 0).\n- Acronym handling (BP, CHF, CBC) not in query_parser â€” may need future tuning.","status":"closed","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T19:51:30.62698-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T20:23:49.638126-06:00","closed_at":"2026-02-01T20:23:49.638126-06:00","close_reason":"Completed. See branch CruxMD-md2-work.","dependencies":[{"issue_id":"CruxMD-md2","depends_on_id":"CruxMD-jfz","type":"blocks","created_at":"2026-01-31T19:51:37.417675-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-md2","depends_on_id":"CruxMD-t2y","type":"blocks","created_at":"2026-01-31T19:51:37.514383-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-md2","depends_on_id":"CruxMD-klo","type":"blocks","created_at":"2026-01-31T19:51:37.611203-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-mde","title":"Epic 5: Task \u0026 Session Infrastructure","description":"Backend infrastructure for task management and session persistence. This epic adds the foundational models and APIs needed for the UX implementation: Task model for actionable work items, Session model for conversation persistence, demo fixtures for clinical scenarios, and context engine enhancements for quick action surfacing.\n\nSee docs/ux-specification.md for full context.\n\n**Stories:**\n- 5.1: Task Model \u0026 API (P1)\n- 5.2: Session Model \u0026 API (P1)\n- 5.3: Demo Fixtures (P1)\n- 5.4: Context Engine Enhancements (P2)","status":"open","priority":1,"issue_type":"epic","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-26T11:52:27.149763-06:00","created_by":"Joe Neumann","updated_at":"2026-01-26T11:52:27.149763-06:00"}
{"id":"CruxMD-mde.1","title":"Story 5.1: Task Model \u0026 API","description":"Backend task model, database schema, and CRUD endpoints.\n\n**Files:**\n- backend/app/models/task.py - Task SQLAlchemy model\n- backend/app/schemas/task.py - CruxTask, AITaskProvenance, TaskContextConfig Pydantic schemas\n- backend/app/routes/tasks.py - Task CRUD endpoints\n- backend/alembic/versions/xxx_add_task_model.py - Migration\n\n**Key Fields:**\n- id, type, category, status, priority, priority_score\n- title, description, patient_id, session_id\n- provenance (JSONB), context_config (JSONB)\n- created_at, modified_at, due_on\n\n**TaskType enum:**\ncritical_lab_review | abnormal_result | hospitalization_alert | patient_message | external_result | pre_visit_prep | follow_up | appointment | research_review | order_signature | custom\n\n**TaskCategory enum:**\ncritical | routine | schedule | research\n\n**TaskStatus enum:**\npending | in_progress | paused | completed | cancelled | deferred\n\n**Acceptance Criteria:**\n- Task model with all fields from UX spec\n- Full CRUD API: GET /api/tasks, GET /api/tasks/{id}, POST /api/tasks, PATCH /api/tasks/{id}\n- Filter by patient_id, category, status\n- Sorting by priority_score, created_at\n\nFoundational story - no dependencies.","status":"closed","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-26T11:52:58.469616-06:00","created_by":"Joe Neumann","updated_at":"2026-01-26T11:58:32.10425-06:00","closed_at":"2026-01-26T11:58:32.10425-06:00","close_reason":"Implemented Task model, schemas, routes, migration, and tests","dependencies":[{"issue_id":"CruxMD-mde.1","depends_on_id":"CruxMD-mde","type":"parent-child","created_at":"2026-01-26T11:52:58.47031-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-mde.2","title":"Story 5.2: Session Model \u0026 API","description":"Session model for conversation persistence and handoff.\n\n**Files:**\n- backend/app/models/session.py - Session SQLAlchemy model\n- backend/app/schemas/session.py - Session, SessionHandoff Pydantic schemas\n- backend/app/routes/sessions.py - Session endpoints\n- backend/alembic/versions/xxx_add_session_model.py - Migration\n\n**Key Fields:**\n- id, type (orchestrating/patient_task), status (active/paused/completed)\n- patient_id, task_id, parent_session_id\n- started_at, last_active_at, completed_at\n- summary, messages (JSONB)\n\n**Endpoints:**\n- GET /api/sessions - List sessions (filter by status, patient_id)\n- GET /api/sessions/{id} - Get session details\n- POST /api/sessions - Create session\n- PATCH /api/sessions/{id} - Update session (pause, complete)\n- POST /api/sessions/{id}/handoff - Create session handoff\n\n**Acceptance Criteria:**\n- Session model supports orchestrating and patient_task types\n- Messages stored as JSONB array\n- Handoff mechanism preserves context between sessions\n- Filter sessions by status (active/paused)\n\nDepends on: Story 5.1 (for task_id reference)","status":"closed","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-26T11:52:58.794354-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T17:13:36.660453-06:00","closed_at":"2026-01-31T17:13:36.660453-06:00","close_reason":"Completed. See branch CruxMD-mde.2-work.","dependencies":[{"issue_id":"CruxMD-mde.2","depends_on_id":"CruxMD-mde","type":"parent-child","created_at":"2026-01-26T11:52:58.794951-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-mde.2","depends_on_id":"CruxMD-mde.1","type":"blocks","created_at":"2026-01-26T11:53:48.451481-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-mde.3","title":"Story 5.3: Demo Fixtures (SUPERSEDED by 5.3a-5.3d)","description":"Create demo data for tasks, sessions, appointments, and patient messages.\n\n**Files:**\n- backend/app/fixtures/tasks.json - 15-20 demo tasks\n- backend/app/fixtures/appointments.json - Schedule data\n- backend/app/fixtures/patient_messages.json - Portal messages\n- Update backend/app/scripts/seed_database.py - Load fixtures\n\n**Requirements:**\n- 8-12 today's appointments, 4-6 tomorrow\n- 3-5 critical tasks, 8-12 routine tasks\n- 2-3 research/learning tasks\n- 5-10 patient messages (some with draft responses)\n\n**Clinical Scenarios (must support):**\n1. Critical hyperkalemia (K+ 6.2) - Robert Chen\n2. Hospital discharge - High-risk care transition\n3. Abnormal imaging - Incidental pulmonary nodule on CT\n4. Diabetes follow-up - Improving A1c, medication adjustment\n5. Patient message - Refill request with clinical nuance\n6. Pre-visit prep - New patient with complex history\n\n**Acceptance Criteria:**\n- Fixtures load without errors via seed_database.py\n- Tasks appear in API with correct categories\n- Patient data matches existing Synthea fixtures\n- Demo covers all TaskType values\n\nDepends on: Story 5.1, Story 5.2","status":"closed","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-26T11:52:59.083803-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T19:25:59.952362-06:00","closed_at":"2026-01-31T19:25:59.952362-06:00","close_reason":"Superseded by CruxMD-i8f (5.3a), CruxMD-z3b (5.3b), CruxMD-bsk (5.3c), CruxMD-5di (5.3d)","dependencies":[{"issue_id":"CruxMD-mde.3","depends_on_id":"CruxMD-mde","type":"parent-child","created_at":"2026-01-26T11:52:59.084335-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-mde.3","depends_on_id":"CruxMD-mde.1","type":"blocks","created_at":"2026-01-26T11:53:48.632292-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-mde.3","depends_on_id":"CruxMD-mde.2","type":"blocks","created_at":"2026-01-26T11:53:48.824832-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-mde.4","title":"Story 5.4: Context Engine Enhancements","description":"Quick action surfacing and task-aware context assembly.\n\n**Files:**\n- backend/app/services/context_engine.py - Enhance existing\n- backend/app/schemas/quick_actions.py - QuickAction schemas\n- backend/app/services/quick_actions.py - Surfacing logic\n\n**QuickAction Schema:**\n- label, type (order|message|refer|document|navigate)\n- priority, source (task_default|ai_insight|clinical_rule)\n- payload (optional)\n\n**Quick Action Surfacing Logic:**\n1. Task-type defaults (e.g., critical_lab_review =\u003e Repeat K+ stat, Call patient)\n2. AI-driven suggestions from last agent response\n3. Clinical rule triggers (e.g., critical K+ + K+-sparing med =\u003e Hold medication)\n\n**Context Assembly:**\n- Get base config from TASK_TYPE_CONFIGS\n- Fetch relevant patient data based on filters\n- Surface max 4 quick actions based on context\n\n**Acceptance Criteria:**\n- QuickAction API returns context-appropriate actions\n- Actions deduplicated and limited to 4\n- Integration with task type configurations\n\nDepends on: Story 5.1","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-26T11:52:59.269922-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T17:13:34.361377-06:00","closed_at":"2026-01-31T17:13:34.361377-06:00","close_reason":"Completed. See branch CruxMD-mde.4-work.","dependencies":[{"issue_id":"CruxMD-mde.4","depends_on_id":"CruxMD-mde","type":"parent-child","created_at":"2026-01-26T11:52:59.270563-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-mde.4","depends_on_id":"CruxMD-mde.1","type":"blocks","created_at":"2026-01-26T11:53:49.01747-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-miu","title":"Story 3.4: Patient Data Endpoints","description":"Create data endpoints for visualization/DataQuery resolution.\n\nFiles:\n- Create: backend/app/routes/data.py\n- Modify: backend/app/main.py (register router)\n\nEndpoints:\n- GET /api/patients/{id}/labs?codes=LOINC1,LOINC2\u0026from=DATE\u0026to=DATE\n- GET /api/patients/{id}/medications?status=active|all\n- GET /api/patients/{id}/conditions?status=active|all\n- GET /api/patients/{id}/timeline?from=DATE\u0026to=DATE\u0026types=TYPE1,TYPE2\n\nAcceptance Criteria:\n- All endpoints require API key authentication\n- Labs endpoint filters by LOINC codes and date range\n- Medications/Conditions filter by clinical status\n- Timeline aggregates encounters, conditions, procedures chronologically\n- Returns FHIR resources (not flattened data)\n- Pagination support (limit/offset)\n- 15-20 tests\n\nNo blockers - can start early in parallel\nPart of Epic 3: Agent Service \u0026 Chat API","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:17:57.840552-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T17:30:47.547461-06:00","closed_at":"2026-01-24T17:30:47.547461-06:00","close_reason":"Completed. See branch CruxMD-miu-work."}
{"id":"CruxMD-nfr","title":"feat: add SSE streaming endpoint","description":"Add POST /api/chat/stream returning StreamingResponse(media_type=text/event-stream). Extract shared setup into helper. Format SSE events (reasoning, narrative, done with conversation_id, error). Keep existing /api/chat unchanged. File: backend/app/routes/chat.py","status":"closed","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T18:54:00.347889-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T19:33:20.242537-06:00","closed_at":"2026-01-31T19:33:20.242537-06:00","close_reason":"Completed. See PR #44, branch CruxMD-nfr-work.","dependencies":[{"issue_id":"CruxMD-nfr","depends_on_id":"CruxMD-lwc","type":"blocks","created_at":"2026-01-31T18:54:10.621207-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-obz","title":"P1 Epic 3: Agent Service \u0026 Chat API","status":"closed","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:16:58.775947-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T19:55:33.363986-06:00","closed_at":"2026-01-24T19:55:33.363986-06:00","close_reason":"All stories complete: 3.1 Schemas, 3.2 Agent Service, 3.3 Chat API, 3.4 Patient Data Endpoints","dependencies":[{"issue_id":"CruxMD-obz","depends_on_id":"CruxMD-r8s","type":"blocks","created_at":"2026-01-24T17:18:33.206935-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-obz","depends_on_id":"CruxMD-iku","type":"blocks","created_at":"2026-01-24T17:18:33.306184-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-obz","depends_on_id":"CruxMD-dv4","type":"blocks","created_at":"2026-01-24T17:18:33.433316-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-obz","depends_on_id":"CruxMD-miu","type":"blocks","created_at":"2026-01-24T17:18:33.532457-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-ohq","title":"feat: add Immunization graph node type with verified layer","description":"Add Immunization as a graph node type with full integration:\n\n1. _upsert_immunization() â€” vaccineCode coding, status, occurrenceDateTime, encounter_fhir_id, fhir_resource\n2. Add to _ENCOUNTER_RELATIONSHIPS: (\"Immunization\", \"HAS_IMMUNIZATION\", \"ADMINISTERED\", \"im\")\n3. Add unique constraint + encounter_fhir_id index in ensure_indexes()\n4. Add dispatch case in build_from_fhir()\n5. Add to search_nodes_by_name searchable list: (\"Immunization\", \"HAS_IMMUNIZATION\", \"display\")\n6. Add get_verified_immunizations() query method (status = \"completed\")\n7. Add immunizations field to VerifiedLayer schema in context.py\n\nFiles: graph.py, context.py, test_graph.py, conftest.py\nFollow existing node type patterns exactly (see Condition, MedicationRequest as templates).","status":"closed","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T20:20:14.489179-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T20:33:12.362786-06:00","closed_at":"2026-02-01T20:33:12.362786-06:00","close_reason":"All 7 integration points implemented and tested (86 graph tests pass, 570 total)"}
{"id":"CruxMD-oin","title":"Story 2.3: Context Engine Core","description":"Build hybrid retrieval engine combining graph verified facts + vector semantic search.\n\nFiles:\n- Create: backend/app/services/context_engine.py\n\nAcceptance Criteria:\n- build_context(patient_id, query, token_budget) method\n- Calls graph.get_verified_conditions/medications/allergies() for verified layer\n- Calls vector search for retrieved layer\n- Generates constraints from verified facts\n- Respects token budget (default 12000)\n- 15-20 unit tests\n\n## Updated Context (from CruxMD-ij8 and CruxMD-wl7)\nSchema imports from app.schemas.context:\n- PatientContext, VerifiedLayer, RetrievedLayer, RetrievedResource\n- Use PatientContext.within_budget() for token budget checking\n- Token estimation via layer.token_estimate() methods\n\nVectorSearchService usage (from app.services.vector_search):\n- VectorSearchService(db_session) - takes AsyncSession\n- search_similar(patient_id, query_embedding, limit, threshold) - core method\n- search_by_text(patient_id, query_text, limit, threshold, embedding_service) - convenience\n- Returns SearchResult dataclass with: resource, score, resource_type, fhir_id\n- MAX_LIMIT is 100, threshold range 0.0-1.0\n- Get query embedding with EmbeddingService.embed_text()\n\nSecurity note: Service enforces patient scoping but API layer must handle auth.\n\nPart of Epic 2: Context Engine","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:17:27.044845-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T18:35:14.566421-06:00","closed_at":"2026-01-24T18:35:14.566421-06:00","close_reason":"Completed. See branch CruxMD-oin-work.","dependencies":[{"issue_id":"CruxMD-oin","depends_on_id":"CruxMD-ij8","type":"blocks","created_at":"2026-01-24T17:18:18.130471-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-oin","depends_on_id":"CruxMD-wl7","type":"blocks","created_at":"2026-01-24T17:18:18.228944-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-ojo","title":"AvatarGeneratorService: Gemini API wrapper + prompt template","description":"Phase 2 core service. Create backend/app/services/avatar_generator.py. Wraps google-genai SDK (imagen-3.0-generate-002 or gemini-2.5-flash-image fallback). Prompt template with demographics (name, age, gender, hair). Extract demographics from FHIR Patient resource. Save PNG with compression to assets/avatars/{fhir_id}.png. Handle content filter rejections, rate limits, API errors.","status":"open","priority":2,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T14:13:08.762262-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T14:13:08.762262-06:00","dependencies":[{"issue_id":"CruxMD-ojo","depends_on_id":"CruxMD-awv","type":"blocks","created_at":"2026-02-01T14:13:13.457899-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-ojo","depends_on_id":"CruxMD-44u","type":"blocks","created_at":"2026-02-01T14:13:13.872255-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-pca","title":"P0 Epic 5: Frontend Infrastructure","status":"closed","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:09:10.627918-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T11:13:05.246117-06:00","closed_at":"2026-01-24T11:13:05.246117-06:00","close_reason":"All child stories complete","dependencies":[{"issue_id":"CruxMD-pca","depends_on_id":"CruxMD-4jg","type":"blocks","created_at":"2026-01-17T13:27:53.786773-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-pca","depends_on_id":"CruxMD-tmq","type":"blocks","created_at":"2026-01-17T13:28:00.978686-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-pca","depends_on_id":"CruxMD-stt","type":"blocks","created_at":"2026-01-17T13:28:01.193543-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-pz7","title":"Story 6.1: Docker Configuration","description":"Create backend/frontend Dockerfiles, docker-compose.yml, configure PostgreSQL with pgvector and Neo4j with memory limits","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:23.429826-06:00","created_by":"Joe Neumann","updated_at":"2026-01-18T14:06:18.571731-06:00","closed_at":"2026-01-18T14:06:18.571731-06:00","close_reason":"Completed. See branch CruxMD-pz7-work and PR #10.","dependencies":[{"issue_id":"CruxMD-pz7","depends_on_id":"CruxMD-w1v","type":"blocks","created_at":"2026-01-17T13:14:05.114951-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-pz7","depends_on_id":"CruxMD-4jg","type":"blocks","created_at":"2026-01-17T13:14:05.226539-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-q6a","title":"feat: frontend SSE proxy route + streaming types","description":"New frontend/app/api/chat/stream/route.ts forwarding backend SSE stream. Add StreamDeltaEvent, StreamDoneEvent, StreamErrorEvent types to frontend/lib/types.ts.","status":"closed","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T18:54:01.802608-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T19:59:47.669916-06:00","closed_at":"2026-01-31T19:59:47.669916-06:00","close_reason":"Completed. See branch CruxMD-q6a-work.","dependencies":[{"issue_id":"CruxMD-q6a","depends_on_id":"CruxMD-nfr","type":"blocks","created_at":"2026-01-31T18:54:10.716005-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-qsq","title":"Story 1.1: pgvector Migration","description":"Add pgvector embedding support to FhirResource model.\n\nFiles:\n- Create: backend/alembic/versions/xxx_add_embedding_column.py\n- Modify: backend/app/models.py (add embedding column)\n- Modify: backend/app/database.py (if pgvector extension setup needed)\n\nAcceptance Criteria:\n- Migration enables pgvector extension (IF NOT EXISTS)\n- Adds embedding VECTOR(1536) column (nullable)\n- Adds embedding_text TEXT column (for debugging)\n- Creates HNSW index for cosine similarity\n- Migration is reversible\n\nPart of Epic 1: Embedding Infrastructure","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:17:25.981879-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T17:27:05.879257-06:00","closed_at":"2026-01-24T17:27:05.879257-06:00","close_reason":"Completed. See branch CruxMD-qsq-work."}
{"id":"CruxMD-qzw","title":"Story 8.1: Test Configuration","description":"Create conftest.py with fixtures, configure pytest-asyncio, create test database fixture","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:49.323137-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T10:14:45.052952-06:00","closed_at":"2026-01-24T10:14:45.052952-06:00","close_reason":"Implemented centralized test configuration with shared fixtures for database, Neo4j, and FHIR test data","dependencies":[{"issue_id":"CruxMD-qzw","depends_on_id":"CruxMD-6iw","type":"blocks","created_at":"2026-01-17T13:14:08.803115-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-r43","title":"feat: Expand knowledge graph â€” properties, bug fix, new node types","description":"Audit-driven expansion of Neo4j knowledge graph. Fix Encounter fhir_resource bug, add missing properties (Observation.category, Encounter.reasonCode, Condition.abatementDateTime), add Immunization and CarePlan node types. See docs/plans/2026-02-01-feat-expand-knowledge-graph-plan.md","status":"closed","priority":1,"issue_type":"epic","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T20:19:56.366322-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T20:41:53.795145-06:00","closed_at":"2026-02-01T20:41:53.795145-06:00","close_reason":"All 5 tasks complete. Graph expanded with bug fix, 3 new properties, 2 new node types."}
{"id":"CruxMD-r8s","title":"Story 3.1: AgentResponse Schemas","description":"Define Pydantic schemas for structured agent output.\n\nFiles:\n- Create: backend/app/schemas/agent.py\n\nKey Types:\n- AgentResponse: thinking, narrative (required, markdown), insights, visualizations, tables, actions, follow_ups\n- Insight: type (info/warning/critical/positive), title, content\n- Visualization: title, type (line_chart/bar_chart/etc), data_query\n- DataTable: title, columns, data_query\n- FollowUp: text, type (question/action/clarification)\n- DataQuery: resourceTypes, filters, timeRange (for frontend resolution)\n\nAcceptance Criteria:\n- All types properly validated\n- 10-12 unit tests\n\nPart of Epic 3: Agent Service \u0026 Chat API","notes":"Acceptance: Create agent.py with AgentResponse, Insight, Visualization, DataTable, DataQuery, FollowUp, Action schemas. Export from __init__.py. 10-12 unit tests. All tests pass.","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:17:27.241337-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T17:36:09.925002-06:00","closed_at":"2026-01-24T17:36:09.925002-06:00","close_reason":"Completed. See branch CruxMD-r8s-work."}
{"id":"CruxMD-scp","title":"feat: useChat SSE streaming consumer","description":"Rewrite sendMessage in useChat to use /api/chat/stream. Add streaming field to DisplayMessage {phase, reasoningText, narrativeText}. SSE parsing with getReader()+TextDecoder. Progressive state updates. AbortController for cancellation. Fallback to /api/chat on failure. File: frontend/hooks/useChat.ts","status":"closed","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T18:54:03.574101-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T20:08:51.670829-06:00","closed_at":"2026-01-31T20:08:51.670829-06:00","close_reason":"Completed. See branch CruxMD-scp-work.","dependencies":[{"issue_id":"CruxMD-scp","depends_on_id":"CruxMD-q6a","type":"blocks","created_at":"2026-01-31T18:54:10.809682-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-sks","title":"Backend: Profile API routes (CRUD)","description":"Create ProfileRepository and profile API routes.\n\nProfileRepository (backend/app/repositories/profile.py):\n- get_by_user_id(user_id) â†’ UserProfile | None\n- upsert(user_id, defaults) â†’ UserProfile (INSERT ... ON CONFLICT DO NOTHING to prevent race conditions)\n- update(user_id, data) â†’ UserProfile\n\nRoutes (backend/app/routes/profile.py):\n- GET /api/profile â€” returns authenticated user's profile. Auto-creates via upsert if missing.\n- PUT /api/profile â€” full replace with Pydantic validation + input sanitization on free-text fields.\n\nInput sanitization: strip control characters, excessive newlines, known injection patterns from free-text fields. Log stripped content.\n\nRegister router in main.py. All endpoints use verify_bearer_token.\n\nFollow patterns from: backend/app/routes/tasks.py, backend/app/repositories/","status":"open","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T16:36:25.769902-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T16:46:01.40701-06:00","dependencies":[{"issue_id":"CruxMD-sks","depends_on_id":"CruxMD-1i9","type":"blocks","created_at":"2026-02-01T16:36:31.340246-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-sks","depends_on_id":"CruxMD-3e8","type":"blocks","created_at":"2026-02-01T16:36:31.440127-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-stt","title":"Story 5.3: Basic UI Shell","description":"Create root layout, main page redirect, chat page placeholder, PatientSelector, PatientHeader, MedicalDisclaimer components\n\n## Updated Context (from CruxMD-tmq)\nAPI client architecture changed from original plan:\n- NO proxy routes (app/api/) - they were removed as redundant\n- Use generated SDK directly from lib/generated/\n- Import API functions like `listPatientsApiPatientsGet` from lib/generated/\n- Run `pnpm generate-api` with backend running to regenerate client\n- API_KEY is server-side only (no NEXT_PUBLIC_ prefix)","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:21.286641-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T10:57:43.224291-06:00","closed_at":"2026-01-24T10:57:43.224291-06:00","close_reason":"Implemented Basic UI Shell with PatientSelector, PatientHeader, MedicalDisclaimer components, chat page, and root redirect","dependencies":[{"issue_id":"CruxMD-stt","depends_on_id":"CruxMD-tmq","type":"blocks","created_at":"2026-01-17T13:14:03.719376-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-t2y","title":"feat: query concept extraction module","description":"Create backend/app/services/query_parser.py. Tokenize query, remove stop words, match tokens/bigrams against graph node display names. Returns ConceptMatch(term, resource_type_hint) list. Files: query_parser.py, test_query_parser.py. See plan doc.","status":"closed","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T19:51:30.424989-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T19:27:48.717316-06:00","closed_at":"2026-02-01T19:27:48.717316-06:00","close_reason":"Completed. See branch CruxMD-t2y-work."}
{"id":"CruxMD-t3q","title":"Story 1.3: Bundle Loader Integration","description":"Integrate embedding generation into FHIR bundle loading.\n\nFiles:\n- Modify: backend/app/services/fhir_loader.py\n- Modify: backend/app/scripts/seed_database.py\n\nAcceptance Criteria:\n- load_bundle() generates embeddings for supported types\n- Embedding failures don't block bundle loading\n- Seed script re-generates embeddings for existing fixtures\n- Action required: Re-run seed_database.py after deployment\n\n## Updated Context (from CruxMD-qsq and CruxMD-181)\n- pgvector migration already run: `embedding` (VECTOR(1536)) and `embedding_text` (TEXT) columns exist\n- Use EmbeddingService from `app.services.embeddings` for embedding generation\n- EMBEDDABLE_TYPES constant lists supported types: Condition, Observation, MedicationRequest, etc.\n- EmbeddingService.embed_resource() returns (embedding, text) tuple or (None, None) for unsupported types\n- Batch processing via embed_resources() for efficiency (handles batching internally)\n- To run migration if needed: `cd backend \u0026\u0026 uv run alembic upgrade head`\n\nBlocked by: (completed - Story 1.1, Story 1.2)\nPart of Epic 1: Embedding Infrastructure","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:17:26.417205-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T17:50:25.100124-06:00","closed_at":"2026-01-24T17:50:25.100124-06:00","close_reason":"Completed. See branch CruxMD-t3q-work.","dependencies":[{"issue_id":"CruxMD-t3q","depends_on_id":"CruxMD-qsq","type":"blocks","created_at":"2026-01-24T17:18:16.527998-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-t3q","depends_on_id":"CruxMD-181","type":"blocks","created_at":"2026-01-24T17:18:16.631969-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-tmq","title":"Story 5.2: API Client Setup","description":"Create app/api/ route proxies, lib/api.ts client helper, lib/types.ts. Configure OpenAPI schema export from backend, add @hey-api/openapi-ts, add pnpm generate-api script for TypeScript client generation.","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:21.071748-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T10:16:01.410335-06:00","closed_at":"2026-01-24T10:16:01.410335-06:00","close_reason":"Implemented API client setup with @hey-api/openapi-ts. PR #13","dependencies":[{"issue_id":"CruxMD-tmq","depends_on_id":"CruxMD-4jg","type":"blocks","created_at":"2026-01-17T13:14:03.487812-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-tmq","depends_on_id":"CruxMD-w1v","type":"blocks","created_at":"2026-01-17T13:14:03.602254-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-u78","title":"Story 4.1: Chat Types \u0026 API Client","description":"Create TypeScript types matching backend AgentResponse schemas.\n\nFiles:\n- Modify: frontend/lib/types.ts or create frontend/lib/types/chat.ts\n\nAcceptance Criteria:\n- TypeScript types matching AgentResponse schema exactly\n- Type guards for runtime validation\n- Run pnpm generate-api after backend API exists (if using openapi-typescript)\n\n## Updated Context (from CruxMD-r8s)\nSchema types to mirror in TypeScript:\n- AgentResponse: { thinking?, narrative (required), insights?, visualizations?, tables?, actions?, follow_ups? }\n- Insight: { type: 'info'|'warning'|'critical'|'positive', title, content }\n- Visualization: { title, type: 'line_chart'|'bar_chart'|etc, data_query, config? }\n- DataTable: { title, columns: TableColumn[], data_query }\n- DataQuery: { resource_types[], filters?, time_range?, limit? }\n- Action: { label, action_type: 'navigate'|'filter'|etc, payload? }\n- FollowUp: { question (not text), intent: 'explore'|'clarify'|etc (not type) }\n\nNote: FollowUp uses `question` and `intent` fields per project plan.\n\n## Updated Context (from CruxMD-dv4)\nThe Chat API endpoint is now live at POST /api/chat:\n- Request: { patient_id: UUID, message: str, conversation_id?: UUID, conversation_history?: ChatMessage[] }\n- Response: ChatResponse { response: AgentResponse, conversation_id: UUID }\n- ChatMessage: { role: 'user'|'assistant', content: str }\n\nInput validation constants to mirror:\n- MAX_MESSAGE_LENGTH = 10000 characters\n- MAX_CONVERSATION_HISTORY = 50 messages\n\nRun `pnpm generate-api` in frontend to auto-generate types from OpenAPI schema.\n\nPart of Epic 4: Frontend Conversational Canvas","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:17:58.034951-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T20:12:18.296975-06:00","closed_at":"2026-01-24T20:12:18.296975-06:00","close_reason":"Completed. See branch CruxMD-u78-work.","dependencies":[{"issue_id":"CruxMD-u78","depends_on_id":"CruxMD-dv4","type":"blocks","created_at":"2026-01-24T17:18:20.270226-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-ucv","title":"P0 Epic 7: Production Deployment","status":"closed","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:09:10.976227-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T15:56:59.263995-06:00","closed_at":"2026-01-24T15:56:59.263995-06:00","close_reason":"All stories complete: VPS provisioned (7.1), production config created (7.2), initial deployment done (7.3). App live at https://app.cruxmd.ai","dependencies":[{"issue_id":"CruxMD-ucv","depends_on_id":"CruxMD-7qj","type":"blocks","created_at":"2026-01-17T13:28:01.858566-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-ucv","depends_on_id":"CruxMD-02p","type":"blocks","created_at":"2026-01-17T13:28:02.084047-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-ucv","depends_on_id":"CruxMD-d9m","type":"blocks","created_at":"2026-01-17T13:28:08.676626-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-uut","title":"Story 1.3: API Key Authentication","description":"Create API key verification in auth.py and add CORS middleware configuration","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:10:06.029602-06:00","created_by":"Joe Neumann","updated_at":"2026-01-17T15:26:14.83605-06:00","closed_at":"2026-01-17T15:26:14.83605-06:00","close_reason":"Completed. See branch CruxMD-uut-work.","dependencies":[{"issue_id":"CruxMD-uut","depends_on_id":"CruxMD-2g1","type":"blocks","created_at":"2026-01-17T13:13:37.51739-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-vcc","title":"chore: re-seed database after graph expansion","description":"After all graph changes merged, re-seed to rebuild graph with new properties and node types.\n\nRun: uv run python -m app.scripts.seed_database\n\nVerify counts:\n- All Encounter nodes have fhir_resource\n- 832 Observations have category (381 vital-signs, 181 laboratory, 199 survey, 60 social-history, 11 procedure)\n- 118 Encounters have reason_display\n- 127 Conditions have abatement_date\n- 73 Immunization nodes with Encounter relationships\n- 13 CarePlan nodes with Condition ADDRESSES relationships\n- All tests pass\n\nDepends on: Tasks 1-4 merged to main","status":"closed","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T20:20:14.695171-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T20:41:53.72923-06:00","closed_at":"2026-02-01T20:41:53.72923-06:00","close_reason":"Re-seed complete. All counts verified: 210/210 Encounter fhir_resource, 832 Observation categories, 118 Encounter reasons, 127 Condition abatements, 73 Immunizations with Encounter edges, 14 CarePlans with 9 ADDRESSES edges.","dependencies":[{"issue_id":"CruxMD-vcc","depends_on_id":"CruxMD-1e2","type":"blocks","created_at":"2026-02-01T20:20:22.255477-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-vcc","depends_on_id":"CruxMD-2r8","type":"blocks","created_at":"2026-02-01T20:20:22.350162-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-vcc","depends_on_id":"CruxMD-ohq","type":"blocks","created_at":"2026-02-01T20:20:22.445512-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-vcc","depends_on_id":"CruxMD-3qv","type":"blocks","created_at":"2026-02-01T20:20:22.539395-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-vop","title":"P0 Epic 8: Testing Infrastructure","status":"closed","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:09:11.132702-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T11:13:05.247539-06:00","closed_at":"2026-01-24T11:13:05.247539-06:00","close_reason":"All child stories complete","dependencies":[{"issue_id":"CruxMD-vop","depends_on_id":"CruxMD-qzw","type":"blocks","created_at":"2026-01-17T13:28:08.900304-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-vop","depends_on_id":"CruxMD-8qg","type":"blocks","created_at":"2026-01-17T13:28:09.123963-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-w1v","title":"Story 1.4: Basic API Routes","description":"Create routes for patients (list, get), fhir (load-bundle), and health check endpoints","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:10:06.238503-06:00","created_by":"Joe Neumann","updated_at":"2026-01-17T15:38:16.934054-06:00","closed_at":"2026-01-17T15:38:16.934054-06:00","close_reason":"Completed. See branch CruxMD-w1v-work.","dependencies":[{"issue_id":"CruxMD-w1v","depends_on_id":"CruxMD-6iw","type":"blocks","created_at":"2026-01-17T13:13:37.634015-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-w1v","depends_on_id":"CruxMD-uut","type":"blocks","created_at":"2026-01-17T13:13:37.746486-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-wl7","title":"Story 2.2: Vector Search Service","description":"Create service for semantic search over FHIR resource embeddings.\n\nFiles:\n- Create: backend/app/services/vector_search.py\n\nAcceptance Criteria:\n- search_similar(patient_id, query_embedding, limit, threshold) method\n- Patient-scoped queries only (security critical)\n- Returns FHIR resources with similarity scores\n- Configurable threshold (default 0.7)\n- 12-15 unit tests\n\n## Updated Context (from CruxMD-qsq)\n- HNSW index exists: `idx_fhir_embedding_hnsw` using cosine distance (\u003c=\u003e)\n- Embedding column: `embedding VECTOR(1536)` on fhir_resources table\n- Index parameters: m=16, ef_construction=64 (suitable for demo scale)\n- Use pgvector's \u003c=\u003e operator for cosine distance\n- Can use EmbeddingService.embed_text() to get query embedding\n\nBlocked by: (completed - Story 1.1)\nPart of Epic 2: Context Engine","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:17:26.854157-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T17:50:16.963376-06:00","closed_at":"2026-01-24T17:50:16.963376-06:00","close_reason":"Completed. See branch CruxMD-wl7-work.","dependencies":[{"issue_id":"CruxMD-wl7","depends_on_id":"CruxMD-qsq","type":"blocks","created_at":"2026-01-24T17:18:17.344734-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-wpn","title":"Story 2.1: Neo4j Service Setup","description":"Create KnowledgeGraph class with connection management, patient_exists, node upsert methods, and build_from_fhir","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:11:57.262331-06:00","created_by":"Joe Neumann","updated_at":"2026-01-17T15:28:34.775195-06:00","closed_at":"2026-01-17T15:28:34.775195-06:00","close_reason":"Completed. See branch CruxMD-wpn-work.","dependencies":[{"issue_id":"CruxMD-wpn","depends_on_id":"CruxMD-2g1","type":"blocks","created_at":"2026-01-17T13:13:57.814908-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-wya","title":"P1 Epic 4: Frontend Conversational Canvas","description":"Frontend Conversational Canvas - the main clinical intelligence interface.\n\n**EXPANDED SCOPE** (per docs/ux-specification.md):\nThis epic now encompasses the full UX specification including:\n- Core canvas components (Story 4.4)\n- Transforming sidebar system (Story 4.5)\n- Quick action pills (Story 4.6)\n- Session management UI (Story 4.7)\n- Mobile responsive layout with bottom sheet (Story 4.8)\n- Full chart escape hatch view (Story 4.9)\n\n**Key Experiences:**\n1. Main Hub - Task queue + conversational canvas\n2. Task Engaged - Focused patient work with context sidebar\n3. Session Inventory - Pause/resume interrupted work\n4. Full Chart View - Traditional EHR escape hatch\n\n**Design Principles:** Quiet competence, earned confidence, keyboard-first navigation\n\nSee docs/ux-specification.md for complete specification.","status":"open","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:16:58.930815-06:00","created_by":"Joe Neumann","updated_at":"2026-01-26T12:02:04.490403-06:00","dependencies":[{"issue_id":"CruxMD-wya","depends_on_id":"CruxMD-u78","type":"blocks","created_at":"2026-01-24T17:18:34.866195-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-wya","depends_on_id":"CruxMD-5fw","type":"blocks","created_at":"2026-01-24T17:18:34.969506-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-wya","depends_on_id":"CruxMD-8h5","type":"blocks","created_at":"2026-01-24T17:18:35.066856-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-wya","depends_on_id":"CruxMD-cwf","type":"blocks","created_at":"2026-01-24T17:18:35.162425-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-wya.1","title":"Story 4.5: Sidebar System","description":"## Story 4.5: Right Context Panel (Updated Architecture)\n\n**Note:** The original \"transforming sidebar\" design has been replaced with a dual sidebar architecture per UX best practices (F-pattern reading, Figma-style left=nav/right=context pattern).\n\n### Already Completed (Ad-hoc work)\n\n- âœ… Left navigation sidebar (`frontend/components/Sidebar.tsx`)\n- âœ… Collapsible nav with icon rail\n- âœ… Recent sessions list\n- âœ… User profile footer\n- âœ… Dark mode support\n\n### This Story: Right Context Panel\n\n**Purpose:** Task-specific structured clinical context panel that appears when a task is engaged.\n\n**Files to Create:**\n- `frontend/components/context/ContextPanel.tsx` - Container with resize handle\n- `frontend/components/context/PatientHeader.tsx` - Photo, name, demographics\n- `frontend/components/context/MedList.tsx` - Medications panel with relevance filtering\n- `frontend/components/context/LabPanel.tsx` - Labs with reference ranges\n- `frontend/components/context/Allergies.tsx` - Allergies panel\n- `frontend/components/context/ProblemList.tsx` - Active problems\n- `frontend/components/context/ResizeHandle.tsx` - Drag handle for width adjustment\n\n**Behavior:**\n- Hidden in hub state (clean canvas)\n- Appears when task is engaged (`/chat?task=xxx`)\n- Width: 300-400px, resizable via drag handle\n- Persist width preference to localStorage\n- Keyboard: `Cmd+Shift+B` toggles visibility\n- Animation: 150-200ms ease-out expand/collapse\n\n**Content Configuration:**\n- Panels dynamically configured per task type\n- Uses TaskContextConfig from task model\n- Filters data to task-relevant items (e.g., K+-related meds for hyperkalemia task)\n\n**Acceptance Criteria:**\n- [ ] Context panel renders when task engaged, hidden in hub\n- [ ] Resize handle allows width adjustment (300-400px)\n- [ ] Width persists across sessions (localStorage)\n- [ ] Keyboard toggle works (Cmd+Shift+B)\n- [ ] Clinical data panels fetch from patient data endpoints\n- [ ] Panels are collapsible with expand/collapse state\n\n## Updated Context (from CruxMD-mde.2)\nSession model is a native SQLAlchemy model (NOT FHIR-based). Import from `backend/app/models/session.py`. Session types: orchestrating, patient_task. Status: active/paused/completed. Handoff endpoint pauses parent and creates child session. Messages stored as JSONB array. No repository layer â€” direct SQLAlchemy queries in route handlers at `backend/app/routes/sessions.py`.","status":"open","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-26T11:53:36.359619-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T17:25:14.165469-06:00","dependencies":[{"issue_id":"CruxMD-wya.1","depends_on_id":"CruxMD-wya","type":"parent-child","created_at":"2026-01-26T11:53:36.360194-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-wya.1","depends_on_id":"CruxMD-cwf","type":"blocks","created_at":"2026-01-26T11:53:49.220842-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-wya.1","depends_on_id":"CruxMD-mde.1","type":"blocks","created_at":"2026-01-26T11:53:49.425672-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-wya.1","depends_on_id":"CruxMD-mde.2","type":"blocks","created_at":"2026-01-26T11:53:49.612542-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-wya.1","depends_on_id":"CruxMD-mde.3","type":"blocks","created_at":"2026-01-26T11:53:49.814826-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-wya.1","depends_on_id":"CruxMD-5di","type":"blocks","created_at":"2026-01-31T19:26:00.142523-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-wya.2","title":"Story 4.6: Quick Action Pills","description":"Dynamic action buttons below chat input based on context.\n\n**Files:**\n- frontend/components/canvas/QuickActionPills.tsx - Pills container\n- frontend/components/canvas/QuickActionPill.tsx - Individual pill button\n- frontend/hooks/useQuickActions.ts - Fetches actions from context engine\n\n**Requirements:**\n- Max 4 pills displayed below input\n- Pills are dynamically surfaced based on task context\n- Keyboard shortcuts: 1-4 triggers pills when input focused\n\n**Pill Sources:**\n1. Task defaults (per task type)\n2. AI insights from last agent response\n3. Clinical rules (e.g., K+-sparing med + critical K+)\n\n**UI:**\n- shadcn Button variant='outline' with rounded-full\n- Icon + label format\n- Primary color accent\n\n**Acceptance Criteria:**\n- Pills render based on useQuickActions hook data\n- Clicking pill triggers action or injects text into input\n- Keyboard shortcuts 1-4 work\n- Pills update when context changes\n\n## Updated Context (from CruxMD-mde.4)\nQuickAction schema at backend/app/schemas/quick_actions.py â€” fields: label, type (QuickActionType enum: order|message|refer|document|navigate), priority (int), source (QuickActionSource enum: task_default|ai_insight|clinical_rule), payload (optional dict). Surfacing logic at backend/app/services/quick_actions.py â€” call surface_quick_actions() which assembles from TASK_TYPE_DEFAULTS, CLINICAL_RULES, and AI suggestions. Dedup is case-insensitive by label, keeping highest priority. Max 4 returned. Context engine has build_task_context() that returns context + quick actions tuple. Note: TASK_TYPE_DEFAULTS (not TASK_TYPE_CONFIGS) is the mapping â€” it's separate from TaskContextConfig.","status":"open","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-26T11:53:36.635331-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T17:25:30.60737-06:00","dependencies":[{"issue_id":"CruxMD-wya.2","depends_on_id":"CruxMD-wya","type":"parent-child","created_at":"2026-01-26T11:53:36.635958-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-wya.2","depends_on_id":"CruxMD-cwf","type":"blocks","created_at":"2026-01-26T11:53:56.791836-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-wya.2","depends_on_id":"CruxMD-mde.4","type":"blocks","created_at":"2026-01-26T11:53:56.999601-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-wya.3","title":"Story 4.7: Session UI","description":"Session inventory modal and handoff visualization.\n\n**Files:**\n- frontend/components/session/SessionInventory.tsx - Modal showing paused sessions\n- frontend/components/session/SessionCard.tsx - Individual paused session card\n- frontend/components/session/SessionIndicator.tsx - Header indicator showing paused count\n- frontend/hooks/useSessions.ts - Sessions state management\n\n**Session Inventory Modal:**\n- Opens with Cmd+Shift+S keyboard shortcut\n- Shows all paused sessions with patient name, task type, time paused\n- Last message preview\n- Resume button restores exact state\n\n**SessionCard:**\n- Task emoji + patient name + task title\n- Time since paused (e.g., '10 min ago')\n- Last message excerpt\n- Resume CTA\n\n**SessionIndicator:**\n- Badge in header showing count of paused sessions\n- Click opens inventory\n\n**Acceptance Criteria:**\n- Cmd+Shift+S opens session inventory\n- Paused sessions displayed with context\n- Resume restores conversation state\n- SessionIndicator shows accurate count\n\n## Updated Context (from CruxMD-mde.2)\nSession API endpoints at /api/sessions. Filter by status (active/paused/completed) and patient_id. Handoff via POST /api/sessions/{id}/handoff â€” pauses parent, creates child inheriting patient_id and task_id. Messages stored as JSONB array (no schema validation at DB level). Session is a native SQLAlchemy model, not FHIR-based. Import schemas from backend/app/schemas/session.py (SessionResponse, SessionListResponse).","status":"open","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-26T11:53:36.92587-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T17:25:21.160028-06:00","dependencies":[{"issue_id":"CruxMD-wya.3","depends_on_id":"CruxMD-wya","type":"parent-child","created_at":"2026-01-26T11:53:36.926401-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-wya.3","depends_on_id":"CruxMD-cwf","type":"blocks","created_at":"2026-01-26T11:53:57.20971-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-wya.3","depends_on_id":"CruxMD-mde.2","type":"blocks","created_at":"2026-01-26T11:53:57.409602-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-wya.4","title":"Story 4.8: Mobile Responsive \u0026 Bottom Sheet","description":"Responsive layout with mobile bottom sheet for context.\n\n**Files:**\n- frontend/components/layout/BottomSheet.tsx - Draggable bottom sheet (using vaul library)\n- frontend/components/layout/ResponsiveLayout.tsx - Layout wrapper with breakpoint handling\n- frontend/hooks/useBreakpoint.ts - Responsive breakpoint hook\n\n**Breakpoints:**\n- Desktop (\u003e=1024px): Horizontal split 65/35\n- Tablet (768-1023px): Collapsible sidebar (~70/30)\n- Mobile (\u003c768px): Full-width canvas + bottom sheet\n\n**Bottom Sheet Snap Points:**\n- Collapsed (~0%): Just drag handle\n- Peek (~15%): Patient name + key metric\n- Half (~50%): PatientHeader + primary data\n- Full (~85%): Complete context panel\n\n**Implementation:**\n- Use shadcn Drawer (vaul) for bottom sheet\n- Custom snap points via vaul API\n- Gesture support for drag\n\n**Acceptance Criteria:**\n- Layout adapts at each breakpoint\n- Mobile shows bottom sheet instead of sidebar\n- Bottom sheet supports all snap points\n- Drag gesture works smoothly\n\nDepends on: Story 4.5 (sidebar system)","status":"open","priority":3,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-26T11:53:37.240653-06:00","created_by":"Joe Neumann","updated_at":"2026-01-26T11:53:37.240653-06:00","dependencies":[{"issue_id":"CruxMD-wya.4","depends_on_id":"CruxMD-wya","type":"parent-child","created_at":"2026-01-26T11:53:37.241214-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-wya.4","depends_on_id":"CruxMD-wya.1","type":"blocks","created_at":"2026-01-26T11:53:57.61905-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-wya.5","title":"Story 4.9: Full Chart View","description":"Traditional EHR tabbed view as escape hatch.\n\n**Files:**\n- frontend/app/chart/[patientId]/page.tsx - Full chart page\n- frontend/components/chart/ChartTabs.tsx - Tab navigation\n- frontend/components/chart/OverviewTab.tsx - Summary view\n- frontend/components/chart/MedicationsTab.tsx - Full med list\n- frontend/components/chart/LabsTab.tsx - Complete lab history\n- frontend/components/chart/ProblemsTab.tsx - Problem list\n- frontend/components/chart/NotesTab.tsx - Clinical notes\n- frontend/components/chart/TimelineTab.tsx - Event timeline\n\n**Tabs:**\n1. Overview - Patient summary, key metrics\n2. Medications - Full medication list with status filters\n3. Labs - Lab history with trends\n4. Problems - Active/historical conditions\n5. Notes - Clinical documentation\n6. Timeline - Chronological event view\n\n**Navigation:**\n- Accessible from 'Expand full chart â†’' in sidebar\n- Back button returns to task-engaged view\n- URL: /chart/[patientId]\n\n**Acceptance Criteria:**\n- All tabs render with real patient data\n- Tab switching maintains scroll position\n- Back navigation returns to previous context\n- Desktop: vertical tabs; Mobile: horizontal scrolling tabs\n\nDepends on: Story 4.5 (sidebar system)","status":"open","priority":3,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-26T11:53:37.432828-06:00","created_by":"Joe Neumann","updated_at":"2026-01-26T11:53:37.432828-06:00","dependencies":[{"issue_id":"CruxMD-wya.5","depends_on_id":"CruxMD-wya","type":"parent-child","created_at":"2026-01-26T11:53:37.433417-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-wya.5","depends_on_id":"CruxMD-wya.1","type":"blocks","created_at":"2026-01-26T11:53:57.812449-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-y0y","title":"CLI script: bulk avatar generation with skip/force/dry-run","description":"Phase 3. Create backend/app/scripts/generate_avatars.py. Query all patients, call AvatarGeneratorService for each. Skip patients with existing avatars by default. --force flag to regenerate all. --dry-run flag to test without API calls. Exponential backoff on 429s. Progress reporting (X/Y generated, N skipped, M failed).","status":"open","priority":2,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T14:13:08.867513-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T14:13:08.867513-06:00","dependencies":[{"issue_id":"CruxMD-y0y","depends_on_id":"CruxMD-awv","type":"blocks","created_at":"2026-02-01T14:13:13.562731-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-y0y","depends_on_id":"CruxMD-ojo","type":"blocks","created_at":"2026-02-01T14:13:13.977243-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-y43","title":"Frontend: Profile page with crux.md editor","description":"Create /profile page for editing physician crux.md preferences.\n\nSections (all on one page, collapsible â€” not URL-driven tabs):\n1. PHI Warning banner at top\n2. General Preferences â€” dropdowns for style/verbosity/tone, textarea for custom_directives\n3. About Me â€” text inputs for specialty, sub_specialties, practice_setting; number input for years_experience; textarea for custom_context\n4. Condition Protocols â€” list of protocol cards (condition name + notes textarea), add/delete\n5. Patient Communication â€” single textarea for notes\n\nUX:\n- Auth-protected route\n- Single 'Save Profile' button at bottom (full PUT, not per-section)\n- Loading/error/success states (no optimistic updates for MVP)\n- Empty state shows defaults\n- Add navigation link in header/sidebar\n\nWire to: GET /api/profile, PUT /api/profile\n\nFollow existing frontend patterns: shadcn/ui, Tailwind CSS, App Router.","status":"open","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-02-01T16:36:26.001662-06:00","created_by":"Joe Neumann","updated_at":"2026-02-01T16:46:01.538768-06:00","dependencies":[{"issue_id":"CruxMD-y43","depends_on_id":"CruxMD-sks","type":"blocks","created_at":"2026-02-01T16:36:31.735096-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-ygm","title":"P1 Epic 2: Context Engine","status":"closed","priority":1,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-24T17:16:58.628813-06:00","created_by":"Joe Neumann","updated_at":"2026-01-24T18:54:53.227329-06:00","closed_at":"2026-01-24T18:54:53.227329-06:00","close_reason":"All stories complete: 2.1 PatientContext Schemas, 2.2 Vector Search Service, 2.3 Context Engine Core. Hybrid retrieval ready.","dependencies":[{"issue_id":"CruxMD-ygm","depends_on_id":"CruxMD-ij8","type":"blocks","created_at":"2026-01-24T17:18:32.121009-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-ygm","depends_on_id":"CruxMD-wl7","type":"blocks","created_at":"2026-01-24T17:18:32.227381-06:00","created_by":"Joe Neumann"},{"issue_id":"CruxMD-ygm","depends_on_id":"CruxMD-oin","type":"blocks","created_at":"2026-01-24T17:18:32.32867-06:00","created_by":"Joe Neumann"}]}
{"id":"CruxMD-z15","title":"Story 4.1: Synthea Fixture Generation","description":"Create Docker-based Synthea setup, generate_fixtures.py script, Makefile target, generate 5 patient bundles with seed 12345","status":"closed","priority":2,"issue_type":"feature","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-17T13:12:04.388261-06:00","created_by":"Joe Neumann","updated_at":"2026-01-17T14:32:01.10175-06:00","closed_at":"2026-01-17T14:32:01.10175-06:00","close_reason":"Completed. See branch CruxMD-z15-work."}
{"id":"CruxMD-z3b","title":"Story 5.3b: FHIR Appointment projection infrastructure","description":"Create AppointmentProjection model, AppointmentFhirSerializer, appointment field extractors, register in ProjectionRegistry, Alembic migration for appointment_projections table, constants. Follow existing Task projection pattern exactly. See plan doc.","status":"open","priority":1,"issue_type":"task","owner":"joseph.r.neumann@protonmail.com","created_at":"2026-01-31T19:25:44.396278-06:00","created_by":"Joe Neumann","updated_at":"2026-01-31T19:25:44.396278-06:00"}
